<div ng-include src="'header.html'"></div>
<div class="container main">
    <div class="row">
        <div id="form-container" class="col-xs-12 col-sm-12 col-md-12 col-lg-12 wbg">
        <p><i class="fa fa-arrow-circle-left"></i> <a href="#/events">Back to listing</a></p>

        <h4>Request For Information Details</h4>
        <!-- REPLY FORM (for FETPS only who received the event) -->
        <p>
        <div ng-show="!isOrganization">
            <p>Do you have anything to contribute regarding this outbreak?</p>
            <a href="#/reply/{{id}}" class="nav-button">Yes, respond to this request</a>
            <a href ng-click="sendResponse({response_permission: '0'})" class="nav-button">No, not at this time</a>
        </div>
        <!-- END REPLY FORM -->


        <!-- OWNER of event gets additional options to close event or send followup email -->
        <span ng-show="isAuthorizedToFollowup">
            <span ng-if="changeStatusText == 'Close'">
                <a href="#/followup/{{id}}" class="nav-button">Send follow-up email to all fetps</a>
            </span>
           <a href="#/{{changeStatusType}}/{{id}}" class="nav-button">{{changeStatusText}} request</a> 
        </span>
        <!-- END CLOSE FORM (for owner of event) -->

        <br>
        <!-- Show Event History Messages -->
        <h4>Event message history: </h4>
        <div style="padding-left:20px" ng-repeat="history_item in eventsList.history">
            <div>
                <!-- Followup messages from Moderator to FETP -->
                <span ng-if="history_item.type == 'Moderator Response'">
                   <span ng-if="history_item.fetp_count > 1">
                       <!-- Followup messages for all FETPs in same organization (Moderator only)-->
                       <span ng-if="(history_item.person_id == userInfo.uid) || (history_item.organization_id == userInfo.organization_id)">
                           <button class="btn btn-xs" ng-click="isCollapsed = !isCollapsed">
                               <i class="fa fa-arrow-circle-right"></i>
                           </button>
                           {{history_item.person}} sent followup to all FETPs, {{history_item.date}}
                           <br><div ng-show="isCollapsed">
                               <br>
                               <div style='background-color: #fff;padding:24px;color:#666;border: 1px solid #B4FEF7;'>
                                   <p>{{history_item.text}}</p>
                               </div>
                           </div><br>
                       </span>
                       <!-- Followup messages for all FETPs not in same organization (Moderator or FETP) -->
                       <span ng-if="(history_item.organization_id != userInfo.organization_id)">
                           <button class="btn btn-xs" ng-click="isCollapsed = !isCollapsed">
                               <i class="fa fa-arrow-circle-right"></i>
                           </button>
                           followup sent to all FETPs, {{history_item.date}}
                           <a ng-if="userInfo.fetp_id" class="btn-default" href="#/reply/{{id}}">
                               <i class="fa fa-reply"> Reply</i>
                           </a>
                           <br><div ng-show="isCollapsed">
                               <br>
                               <div style='background-color: #fff;padding:24px;color:#666;border: 1px solid #B4FEF7;'>
                                   <p>{{history_item.text}}</p>
                               </div>
                           </div><br>
                       </span>
                    </span>
                    <span ng-if="history_item.fetp_count == 1">
                        <!-- Followup messages for one FETP in same organization (Moderator only)-->
                        <span ng-if="(history_item.person_id == userInfo.uid) || (history_item.organization_id == userInfo.organization_id)">
                            <button class="btn btn-xs" ng-click="isCollapsed = !isCollapsed">
                                <i class="fa fa-arrow-circle-right"></i>
                            </button>
                            {{history_item.person}} sent followup to 1 FETP, {{history_item.date}}
                            <br><div ng-show="isCollapsed">
                                <br>
                                <div style='background-color: #fff;padding:24px;color:#666;border: 1px solid #B4FEF7;'>
                                    <p>{{history_item.text}}</p>
                                </div>
                            </div><br>
                        </span>
                        <!-- Followup messages for one FETP not in same organization (Moderator or FETP)-->
                        <span ng-if="(history_item.organization_id != userInfo.organization_id) && userInfo.uid || (history_item.fetp_id == userInfo.fetp_id)">
                            <button class="btn btn-xs" ng-click="isCollapsed = !isCollapsed">
                                <i class="fa fa-arrow-circle-right"></i>
                            </button>
                            followup sent to FETP, {{history_item.date}}
                            <a ng-if="userInfo.fetp_id" class="btn-default" href="#/reply/{{id}}">
                                <i class="fa fa-reply"> Reply</i>
                            </a>
                            <br><div ng-show="isCollapsed">
                                <br>
                                <div style='background-color: #fff;padding:24px;color:#666;border: 1px solid #B4FEF7;'>
                                    <p>{{history_item.text}}</p>
                                </div>
                            </div><br>
                        </span>
                    </span>
                </span>
                <!-- FETP Response Messages (Moderator or FETP)-->
                <span ng-if="(history_item.type == 'FETP Response') && (userInfo.uid || (history_item.fetp_id == userInfo.fetp_id))">
                    <button class="btn btn-xs" ng-click="isCollapsed = !isCollapsed">
                        <i class="fa fa-arrow-circle-right"></i>
                    </button>
                    {{history_item.type}}, {{history_item.date}}
                    <a ng-if="(history_item.organization_id == userInfo.organization_id) " class="btn-default" href="#/followup/{{id}}/{{history_item.response_id}}">
                        <i class="fa fa-reply"> Reply</i>
                    </a>
                    <br><div ng-show="isCollapsed">
                        <br>
                        <div style='background-color: #fff;padding:24px;color:#666;border: 1px solid #B4FEF7;'>
                            <p>{{history_item.text}}</p>
                        </div>
                    </div><br>
                </span>
                <!-- Original Event Request Message in same organization (Moderator or FETP)-->
                <span ng-if="(history_item.type == 'Event Request') && (history_item.organization_id == userInfo.organization_id)">
                    <button class="btn btn-xs" ng-click="isCollapsed = !isCollapsed">
                        <i class="fa fa-arrow-circle-right"></i>
                    </button>
                    {{history_item.person}} sent original event request, {{history_item.date}}
                    <br><div ng-show="isCollapsed">
                        <br>
                        <div style='background-color: #fff;padding:24px;color:#666;border: 1px solid #B4FEF7;'>
                            <div>
                                <strong>Title:</strong> {{history_item.title}}<br>
                                <strong>Location:</strong> {{history_item.location}}
                                <p><br>{{history_item.personalized_text}}</p>
                            </div>
                            <p>{{history_item.text}}</p>
                        </div>
                    </div><br>
                </span>
                <!-- Original Event Request Message not in same organization (Moderator)-->
                <span ng-if="(history_item.type == 'Event Request') && (history_item.organization_id != userInfo.organization_id)">
                    <button class="btn btn-xs" ng-click="isCollapsed = !isCollapsed">
                        <i class="fa fa-arrow-circle-right"></i>
                    </button>
                    original event request sent, {{history_item.date}}
                    <br><div ng-show="isCollapsed">
                        <br>
                        <div style='background-color: #fff;padding:24px;color:#666;border: 1px solid #B4FEF7;'>
                            <div>
                                <strong>Title:</strong> {{history_item.title}}<br>
                                <strong>Location:</strong> {{history_item.location}}
                                <p><br>{{history_item.personalized_text}}</p>
                            </div>
                            <p>{{history_item.text}}</p>
                        </div>
                    </div><br>
                </span>
                <!-- Event open/closed status message in same organization message (Moderator) -->
                <span ng-if="(history_item.type == 'Event Notes') && (history_item.organization_id == userInfo.organization_id)">
                    <button class="btn btn-xs" ng-click="isCollapsed = !isCollapsed">
                        <i class="fa fa-arrow-circle-right"></i>
                    </button>
                    {{history_item.person}} {{history_item.status}} event request, {{history_item.date}}
                    <br><div ng-show="isCollapsed">
                        <br>
                        <div style='background-color: #fff;padding:24px;color:#666;border: 1px solid #B4FEF7;'>
                            <p>{{history_item.text}}</p>
                        </div>
                    </div><br>
                </span>
                <!-- Event open/closed status message not in same organization message (Moderator or FETP)-->
                <span ng-if="(history_item.type == 'Event Notes') && (history_item.organization_id != userInfo.organization_id)">
                    <button class="btn btn-xs" ng-click="isCollapsed = !isCollapsed">
                        <i class="fa fa-arrow-circle-right"></i>
                    </button>
                    {{history_item.status}} event request, {{history_item.date}}
                    <br><div ng-show="isCollapsed">
                        <br>
                        <div style='background-color: #fff;padding:24px;color:#666;border: 1px solid #B4FEF7;'>
                            <p>{{history_item.text}}</p>
                        </div>
                    </div><br>
                </span>
            </div>
        </div>
        </div>
    </div><!--row-->
</div><!--container main-->
