(()=>{"use strict";var e=function(e,t){return{isAuthenticated:function(){return e.userinfo=t.get("epiUserInfo"),e.userinfo?1:0}}};e.$inject=["$rootScope","$cookieStore"];const t=e;var a=function(e,t,a,o){return{getEvents:function(i){var n=i?"&event_id="+i:"";void 0===t.userinfo.uid?n+="&fetp_id="+t.userinfo.fetp_id:n+="&uid="+t.userinfo.uid;var r=a.path().split("/");return n+="&from="+r[1],void 0!==r[2]&&(n+="&detail="+r[2]),e({method:"JSONP",url:o+"scripts/EventsAPI.php?auth=true&callback=JSON_CALLBACK"+n})}}};a.$inject=["$http","$rootScope","$location","urlBase"];const o=a;var n=function(e,t,a,o){return{getEvents:function(i,n,r){var s=i?"&event_id="+i:"";void 0===t.userinfo||"PR"==t.dashboardType?s+="&public=1":void 0===t.userinfo.uid?s+="&fetp_id="+t.userinfo.fetp_id:s+="&uid="+t.userinfo.uid,s+="&start_date="+n,s+="&end_date="+r;var l=a.path().split("/");return s+="&from="+l[1],void 0!==l[2]&&(s+="&detail="+l[2]),e({method:"JSONP",url:o+"scripts/EventsAPI2.php?auth=true&callback=JSON_CALLBACK"+s})}}};n.$inject=["$http","$rootScope","$location","urlBase"];const r=n;var s=function(e){return{getPdfURLS:function(){return e.get("/newsletter.json")}}};s.$inject=["$http"];const l=s,c=angular.module("EpicoreApp.services",[]).factory("authService",t).factory("epicoreCacheService",(function(){var e={memberPortalInfoAll:[],memberPortalInfoPastYear:[],memberPortalInfoPastQuarter:[]};return{clear:function(){e={}},setMemberPortalInfoAll:function(t){return e.memberPortalInfoAll=t},setMemberPortalInfoPastYear:function(t){return e.memberPortalInfoPastYear=t},setMemberPortalInfoPastQuarter:function(t){return e.memberPortalInfoPastQuarter=t},getMemberPortalInfoAll:function(){return e.memberPortalInfoAll},getMemberPortalInfoPastYear:function(){return e.memberPortalInfoPastYear},getMemberPortalInfoPastQuarter:function(){return e.memberPortalInfoPastQuarter}}})).factory("eventAPIservice",o).factory("eventAPIservice2",r).factory("newsService",l).factory("rfiForm",(function(){var e={};return{clear:function(){for(var t in e)delete e[t]},get:function(){return e}}})).run(["$rootScope","$location","authService","epicoreVersion",function(e,t,a,o){e.$on("$routeChangeStart",(function(i,n,r){var s=t.path(),l=s.split("/"),c=new Array("fetp","about","terms","mod","application","news","application_confirm","login","setpassword","resetpassword","who","how","educator","provider","professional","researcher","certificate","events_public","login_mobile");a.isAuthenticated()||-1!=c.indexOf(l[1])||("home"==l[1]?t.path("/home"):t.path("/home").search({redir:s}));var d="fetp"==l[1]&&void 0!==l[3]?"/events/"+l[3]:"/events";"2"==o&&(d="fetp"==l[1]&&void 0!==l[3]?"/events2/"+l[3]:"/events2"),null!=e.userinfo&&(d=e.userinfo.fetp_id&&"N"==e.userinfo.active?"home":d),!a.isAuthenticated()||"/home"!=t.path()&&"fetp"!=l[1]||t.path(d)}))}]);var d=function(e,t,a,o,n,r,s,l,c){var d=o.path();if(e.init=function(){e.sharedCacheMemInfo=l.getMemberPortalInfoPastQuarter(),e.userInfo=r.get("epiUserInfo"),e.superuser=void 0!==e.userInfo&&e.userInfo.superuser,e.showpage=!1,e.membersavailable=!1,e.eventsavailable=!1,e.num_applicants=0,e.num_accepted=0,e.num_approved=0,e.num_inactive=0,e.num_denied=0,e.num_preapproved=0,e.num_setpassword=0,e.allapp=!1;var t=[];t.push({name:"All",value:"all"}),t.push({name:"Past Year",value:"past-year"}),t.push({name:"Past Quarter",value:"recent"}),e.event_months=t.reverse(),e.selected_month=t[0],e.urlBaseStr=s;var a,o=moment().subtract(3,"months").format("YYYY-MM-DD");a=moment().format("YYYY-MM-DD"),e.selected_start_date=o,e.selected_end_date=a,e.selectedItems=[],e.IsAllCollapsed=!1,e.activeHeaderItem="",e.searchTermSubmitted=!1,e.displayAcceptedDateColumn=!1,e.displayApprovedDateColumn=!1,e.displayCourseColumn=!1,e.displayPasswordColumn=!1,e.predicateForSort="apply_date_iso",e.displayApplicantNumber=!1,e.displayMemberNumber=!1,e.pwcheck=!1,e.displayHeaderGreenBar=!1,e.outputList=[]},e.init(),0==Object.keys(e.sharedCacheMemInfo).length||!e.sharedCacheMemInfo){var u={};u.startDate=e.selected_start_date,u.endDate=e.selected_end_date,t({url:s+"scripts/approval.php",method:"POST",data:u}).then((function(t){var a=t.data;l.setMemberPortalInfoPastQuarter(a),e.loadMemberInfo(d)}))}e.loadMemberInfo=function(t){e.showpage=!1,e.membersavailable=!1,e.eventsavailable=!1,e.num_applicants=0,e.num_accepted=0,e.num_approved=0,e.num_inactive=0,e.num_denied=0,e.num_preapproved=0,e.num_setpassword=0,e.allapp=!1,e.activeHeaderItem="",e.searchTermSubmitted=!1,e.displayAcceptedDateColumn=!1,e.displayApprovedDateColumn=!1,e.displayCourseColumn=!1,e.displayPasswordColumn=!1,e.displayApplicantNumber=!1,e.displayMemberNumber=!1;var o=e.selected_month,i=[];i="past-year"==o.value?angular.copy(l.getMemberPortalInfoPastYear()):"all"==o.value?angular.copy(l.getMemberPortalInfoAll()):angular.copy(l.getMemberPortalInfoPastQuarter());var n=(new Date).getFullYear(),r=[],s=[],c=[],d=[],u=[],p=[],m=[];for(var f in i){i[f].member_id=parseInt(i[f].member_id);var h=a("date")(new Date(i[f].apply_date),"yyyy"),v=a("date")(new Date(i[f].accept_date),"yyyy"),_=a("date")(new Date(i[f].maillist_id),"yyyy");i[f].apply_date=h==n?a("date")(new Date(i[f].apply_date),"MMM dd"):a("date")(new Date(i[f].apply_date),"dd MMM, yyyy"),i[f].accept_date=v==n?a("date")(new Date(i[f].accept_date),"MMM dd"):a("date")(new Date(i[f].accept_date),"dd MMM, yyyy"),i[f].approve_date=_==n?a("date")(new Date(i[f].approve_date),"MMM dd"):a("date")(new Date(i[f].approve_date),"dd MMM, yyyy"),i[f].apply_date=i[f].apply_date.replace(/-/g,""),i[f].accept_date=i[f].accept_date.replace(/-/g,""),i[f].approve_date=i[f].approve_date.replace(/-/g,""),"Pending"==i[f].status&&(s.push(i[f]),"Yes"!=i[f].pword&&p.push(i[f]),e.num_accepted++),"Approved"==i[f].status&&(u.push(i[f]),e.num_approved++),"Inactive"==i[f].status&&(r.push(i[f]),e.num_inactive++),"Denied"==i[f].status&&(d.push(i[f]),e.num_denied++),"Pre-approved"==i[f].status&&(c.push(i[f]),"Yes"!=i[f].pword&&m.push(i[f]),e.num_preapproved++),"Yes"==i[f].pword&&e.num_setpassword++}switch(t){case"/approval/accepted":e.activeHeaderItem="Accepted",e.outputList=s,e.nppassword_applicants=p,e.displayAcceptedDateColumn=!0,e.displayPasswordColumn=!0,e.displayMemberNumber=!0;break;case"/approval/pre_approved":e.activeHeaderItem="Pre Approved",e.outputList=c,e.nppassword_applicants=m,e.displayAcceptedDateColumn=!0,e.displayPasswordColumn=!0,e.displayCourseColumn=!0,e.displayMemberNumber=!0;break;case"/approval/members":e.activeHeaderItem="Members",e.outputList=u,e.nppassword_applicants=[],e.displayAcceptedDateColumn=!0,e.displayApprovedDateColumn=!0,e.displayCourseColumn=!0,e.displayMemberNumber=!0;break;case"/approval/denied":e.activeHeaderItem="Denied",e.nppassword_applicants=[],e.outputList=d,e.displayApplicantNumber=!0;break;default:e.activeHeaderItem="New Applicants",e.outputList=r,e.nppassword_applicants=[],e.displayApplicantNumber=!0}return e.displayAllRows=!0,e.allapp=!1,e.inactive_applicants=r,e.applicants=e.outputList,e.searchResetList=e.outputList,e.all_applicants=i,e.inactive_applicants=r,e.num_applicants=e.applicants.length,e.showpage=!0,e.outputList.length>0?e.toggleRowExpandCollapse=!0:e.toggleRowExpandCollapse=!1,i},e.clearSearch=function(t){"far fa-search fa-times"==t.target.attributes[0].nodeValue&&(e.query_input="",e.searchMembers("reset"))},e.searchMembers=function(t){var a=e.selected_month;e.sharedCacheMemInfo=[],a&&"past-year"==a.value?e.sharedCacheMemInfo=angular.copy(l.getMemberPortalInfoPastYear()):a&&"all"==a.value?e.sharedCacheMemInfo=angular.copy(l.getMemberPortalInfoAll()):e.sharedCacheMemInfo=angular.copy(l.getMemberPortalInfoPastQuarter()),13==t.keyCode?(e.query=e.query_input,e.searchTermSubmitted=!0,""!=e.query?e.applicants=e.sharedCacheMemInfo:e.applicants=e.applicants):"reset"==t&&(e.query="",e.searchTermSubmitted=!0,e.applicants=e.searchResetList)},e.passwordCheck=function(){e.pwcheck=!e.pwcheck,1==e.pwcheck?e.applicants=e.nppassword_applicants:e.applicants=e.outputList},e.setVisible=function(t){angular.forEach(e.applicants,(function(e){e.visible=t})),e.displayAllRows=!e.displayAllRows},e.isChecked=function(t){1==t.Selected?e.selectedItems.push(t.maillist_id):e.selectedItems.splice(e.selectedItems.indexOf(t.maillist_id),1),e.selectedItems.length>0?e.displayHeaderGreenBar=!0:(e.displayHeaderGreenBar=!1,e.IsAllChecked=!1)},e.CheckUncheckHeader=function(t){e.displayHeaderGreenBar=!0;for(var a=e.applicants,o=0;o<a.length;o++){if(e.selectedItems.push(a[o].maillist_id),!t.Selected){e.IsAllChecked=!1,e.displayHeaderGreenBar=!1;break}e.displayHeaderGreenBar=!0}},e.CheckUncheckAll=function(){e.displayHeaderGreenBar=!e.displayHeaderGreenBar;for(var t=e.applicants,a=0;a<t.length;a++)e.selectedItems.push(t[a].maillist_id),e.applicants[a].Selected=e.IsAllChecked},e.getApprovalMonth=function(){e.isRouteLoading=!0;var a=e.selected_month,i=[],n="",r="";"all"==a.value?(n=moment(c).format("YYYY-MM-DD"),r=moment().format("YYYY-MM-DD"),i=angular.copy(l.getMemberPortalInfoAll())):"recent"==a.value?(n=moment().subtract(3,"months").format("YYYY-MM-DD"),r=moment().format("YYYY-MM-DD"),i=angular.copy(l.getMemberPortalInfoPastQuarter())):"past-year"==a.value&&(n=moment().subtract(12,"months").format("YYYY-MM-DD"),r=moment().format("YYYY-MM-DD"),i=angular.copy(l.getMemberPortalInfoPastYear())),e.selected_start_date=n,e.selected_end_date=r;var s=o.path();if(i&&i.length>0)e.loadMemberInfo(s),e.isRouteLoading=!1;else{var d={};d.startDate=e.selected_start_date,d.endDate=e.selected_end_date,t({url:e.urlBaseStr+"scripts/approval.php",method:"POST",data:d}).then((function(t){var o=t.data;"all"==a.value?l.setMemberPortalInfoAll(o):"recent"==a.value?l.setMemberPortalInfoPastQuarter(o):"past-year"==a.value&&l.setMemberPortalInfoPastYear(o),e.loadMemberInfo(s),e.isRouteLoading=!1}))}},e.setLocationStatus=function(a,o){t({url:s+"scripts/setLocationStatus.php",method:"POST",data:u={maillist_id:a,action:o}}).then((function(t){var i=t.data;if("success"===i.status)for(var n in e.applicants)e.applicants[n].maillist_id==a&&(e.applicants[n].locations="enable"==o?"1":"0");else alert(i.message)}))},e.selectMembers=function(t){1==confirm("Please wait a little while if you select OK")&&(t?(e.allapp=!0,e.applicants=e.all_applicants):(e.allapp=!1,e.applicants=e.inactive_applicants))},e.approveApplicantHeader=function(e,t){},e.approveApplicant=function(t,a,o){if(confirm("Are you sure to continue with '"+o+"' action?"))if(1==t&&e.selectedItems.length>1)for(i=0;i<e.selectedItems.length-1;i++)u={maillist_id:e.selectedItems[i],action:o},e.updateMemberStatus(u);else""==a&&(a=e.selectedItems[0]),u={maillist_id:a,action:o},e.updateMemberStatus(u)},e.updateMemberStatus=function(a){t({url:s+"scripts/setMemberStatus.php",method:"POST",data:a}).then((function(t){var o=t.data;if("success"===o.status)for(var i in e.applicants)e.applicants[i].maillist_id==a.maillist_id&&(e.applicants[i].status=o.member_status);else alert(o.message)}))},e.downloadMembers=function(){e.isRouteLoading=!0,t({url:s+"scripts/downloadMembers.php",method:"POST"}).then((function(){e.membersavailable=!0,e.isRouteLoading=!1}))},e.downloadEvents=function(){e.isRouteLoading=!0,t({url:s+"scripts/downloadEventStats.php",method:"POST"}).then((function(){e.eventsavailable=!0,e.isRouteLoading=!1}))},e.sendReminderEmailToSelectedApplicants=function(a){var o=[];for(i=0;i<e.selectedItems.length;i++)u={action:a,memberid:e.selectedItems[i]},o.push(new Promise((function(e){t({url:s+"scripts/sendreminder.php",method:"POST",data:u}).then((function(){e(!0)}))})));Promise.all(o).then((function(){e.selectedItems.length>1?alert("The message has been sent to ".concat(e.selectedItems.length," persons.")):alert("The message has been sent.")}))},e.sendReminder=function(e){confirm("Are you sure you want to send reminder emails?")&&t({url:s+"scripts/sendreminder.php",method:"POST",data:u={action:e}}).then((function(e){var t=e.data;alert(t.length+" emails sent.")}))},e.editApplicant=function(e,t){o.path("/application/"+e+"/"+t+"/member")},e.deleteApplicant=function(e){confirm("Are you sure you want to delete this user?")&&t({url:s+"scripts/deleteuser.php",method:"POST",data:u={uid:e}}).then((function(e){var t=e.data;"success"===t.status?n.reload():alert(t.message)}))}};d.$inject=["$scope","$http","$filter","$location","$route","$cookieStore","urlBase","epicoreCacheService","epicoreV1StartDate"];const u=d;var p=function(e,t,a,o){e.userInfo=t.get("epiUserInfo");var i={};i.uid=e.userInfo.fetp_id,i.idtype="fetp",a({url:o+"scripts/getapplicant.php",method:"POST",data:i}).then((function(t){var a=t.data;e.member_name=a.firstname+" "+a.lastname,e.approve_date=a.approve_date;var o=new Array("January","February","March","April","May","June","July","August","September","October","November","December");if(a.approve_date){var i=a.approve_date.split(" "),n="th Day of ";1==(i=i[0].split("-"))[2]||21==i[2]||31==i[2]?n="st Day of ":2==i[2]||22==i[2]?n="nd Day of ":3!=i[2]&&23!=i[2]||(n="rd Day of "),e.approve_date=Number(i[2])+n+o[Number(i[1])-1]+", "+i[0]}})),e.printPage=function(e){window.print()}};p.$inject=["$scope","$cookieStore","$http","urlBase"];const m=p;var f=function(e,t,a,o,i,n,r){if(t.userInfo=e.userInfo=o.get("epiUserInfo"),t.eventid=a.id,t.eventid){var s={};s.event_id=t.eventid,n({url:r+"scripts/getrequest.php",method:"POST",data:s}).then((function(e){var a=e.data;t.formData=a,t.formData.additionalText=a.personalized_text}))}t.updateEvent=function(e,a){if(a){if(e.latlon=$("#default_location").val(),e.location=$("#searchTextField").val(),!e.latlon)return alert("Geolocation failed - please scroll down and select a location from the auto-suggester in the location field so that we have the coordinates of the event."),t.formData.location="",!1;n({url:r+"scripts/updaterequest.php",method:"POST",data:e}).then((function(e){"success"===e.data.status&&i.path("/success/6")}))}}};f.$inject=["$rootScope","$scope","$routeParams","$cookieStore","$location","$http","urlBase"];const h=f;var v=function(e,t,a,o,i,n,r,s){e.mobile="mobile"==s,e.isRouteLoading=!0,e.eventsList=[],e.userInfo=a.get("epiUserInfo"),e.id=t.id?t.id:null,e.allFETPs=!t.response_id,e.onOpen=!(o.path().indexOf("/closed")>0),e.anonymous_disabled=!1,e.formData||(e.formData={}),e.validResponses=0,n.getEvents(e.id).then((function(a){var o=a.data;if(e.isOrganization=!(e.userInfo.fetp_id>0),null!=o.EventsList&&(e.isAuthorizedToFollowup=e.userInfo.organization_id==o.EventsList.org_requester_id,e.changeStatusText="C"==o.EventsList.estatus?"Re open":"Close",e.changeStatusType="C"==o.EventsList.estatus?"reopen":"close",e.isAuthorizedFETP=!1,e.isRequester=o.EventsList.requester_id==e.userInfo.uid,null!=o.EventsList.fetp_ids&&-1!=o.EventsList.fetp_ids.indexOf(e.userInfo.fetp_id)&&(e.isAuthorizedFETP=!0),o.EventsList.fetp_ids&&(e.num_fetp=o.EventsList.fetp_ids.length),e.eventsList=o.EventsList,e.filePreview=o.EventsList.filePreview?o.EventsList.filePreview:""),e.response_text="",t.response_id){var n={};n.uid=e.userInfo.uid,n.org_id=e.userInfo.organization_id,n.fetp_id=e.userInfo.fetp_id,n.response_id=t.response_id,i({url:r+"scripts/getresponse.php",method:"POST",data:n}).then((function(t){var a=t.data;e.response_text=a.response,e.responder_id=a.responder_id,e.permission_id=a.response_permission_id}))}if(e.num_notrated_responses=0,e.onOpen)e.num_notrated_responses=o.numNotRatedResponses;else if(e.eventsList)for(var s in e.eventsList.yours)e.num_notrated_responses+=parseInt(e.eventsList.yours[s].num_notrated_responses);for(var l in e.eventsList.history)"0"!==e.eventsList.history[l].permission&&"Member Response"==e.eventsList.history[l].type&&e.userInfo.uid&&e.validResponses++;Date.prototype.yyyymmdd=function(){var e=this.getFullYear().toString(),t=(this.getMonth()+1).toString(),a=this.getDate().toString();return e+"-"+(t[1]?t:"0"+t[0])+"-"+(a[1]?a:"0"+a[0])};var c=new Date;for(var s in e.date=c.setDate(c.getDate()-14),e.unclosed=0,e.eventsList.yours)newdate=e.eventsList.yours[s].num_followups[0].iso_date,newdate<c.yyyymmdd()&&e.unclosed++;e.isRouteLoading=!1})),e.sendFollowup=function(a,n){if(n){if(e.submitDisabled=!0,a.uid=e.userInfo.uid,a.event_id=t.id,t.id)var s=t.id;t.response_id&&(a.response_id=t.response_id),i({url:r+"scripts/sendfollowup.php",method:"POST",data:a}).then((function(){e.submitDisabled=!1,o.path("/success/3/"+s)}))}},e.changeRequestStatus=function(a,n,s){var l=[],c=[],d=[];if(s&&("Close"==n||"Update"==n)&&e.validResponses>0)for(var u in e.eventsList.history){var p=e.eventsList.history[u].response_id,m=e.eventsList.history[u].type,f=e.eventsList.history[u].fetp_id,h=e.eventsList.history[u].organization_id,v=e.eventsList.history[u].useful,_=e.eventsList.history[u].permission;if("Member Response"==m&&"0"!==_&&(e.userInfo.uid||f==e.userInfo.fetp_id)&&h==e.userInfo.organization_id){if(null===v)return alert("Please assess all member responses."),e.close_message="Please assess all member responses.",!1;"1"===v?l.push(p):"2"===v?c.push(p):d.push(p)}}s&&(e.submitDisabled=!0,a.event_id=t.id,a.uid=e.userInfo.uid,a.thestatus=n,a.useful_rids=l.toString(),a.usefulpromed_rids=c.toString(),a.notuseful_rids=d.toString(),i({url:r+"scripts/changestatus.php",method:"POST",data:a}).then((function(t){var a=t.data;if("success"===a.status){e.submitDisabled=!1;var i;i="Update"==n?8:"Reopen"==n?5:4,o.path("/success/"+i)}else alert(a.reason)})))},e.sendResponse=function(a,n){if(0==a.response_permission||n){if(e.submitDisabled=!0,a.event_id=t.id,a.fetp_id=e.userInfo.fetp_id,t.id)var s=t.id;i({url:r+"scripts/sendresponse.php",method:"POST",data:a}).then((function(t){"success"===t.data.status?o.path("/success/2/"+s):alert("response failed!"),e.submitDisabled=!1}))}},e.deleteEvent=function(t){confirm("Are you sure you want to delete this event?")&&(data={eid:t,superuser:e.userInfo.superuser},i({url:r+"scripts/deleteEvent.php",method:"POST",data}).then((function(e){var t=e.data;"success"===t.status?o.path("/success/7"):alert(t.reason)})))}};v.$inject=["$scope","$routeParams","$cookieStore","$location","$http","eventAPIservice","urlBase","epicoreMode"];const _=v;var g=function(e,t,a,o,i,n,r,s,l,c,d,u,p,m){e.mobile="mobile"==c,e.epicore_version=d,e.isRouteLoading=!0,e.eventsList=[],e.isShowNotScoredEvents=!1,e.userInfo=i.get("epiUserInfo"),e.id=o.id?o.id:null,e.allFETPs=!o.response_id,e.rfiOrderByValue="iso_create_date",e.onOpen=!(n.path().indexOf("/closed")>0),e.onOpen||(e.rfiOrderByValue="iso_action_date"),e.publicDashboard=n.path().indexOf("/events_public")>=0,e.isPublicArticleView=n.path().indexOf("/articles")>=0,e.anonymous_disabled=!1,e.formData||(e.formData={}),e.validResponses=0,e.eventType="AO",a.dashboardType="MR",e.cbsuffix=Date.now();for(var f=moment(m),h=moment(),v=[];h>f||f.format("M")===h.format("M");)v.push({name:f.format("YYYY-MMMM"),value:f.format("YYYY-MM")}),f.add(1,"month");v.push({name:"All",value:"all"}),v.push({name:"Most Recent",value:"recent"}),e.event_months=v.reverse(),e.selected_month=v[0],e.getEventMonth=function(t){var a="",o="",i="all";"all"==t.value?(a=moment(m).format("YYYY-MM-DD"),o=moment().format("YYYY-MM-DD")):"recent"==t.value?(a=moment().subtract(3,"months").format("YYYY-MM-DD"),o=moment().format("YYYY-MM-DD"),i=10):(a=moment(t.value+"-01").format("YYYY-MM-DD"),o=moment(t.value+"-01").add(1,"month").format("YYYY-MM-DD")),_(a,o,i),e.isShowNotScoredEvents=!1},e.ufiles=[],e.uploadFiles=function(t,a){e.files=t,e.errFiles=a;var o=1;angular.forEach(t,(function(a){e.isRouteLoading=!0,a.upload=u.upload({url:"scripts/uploadfile.php",data:{file:a,event_id:e.id,fetp_id:e.userInfo.fetp_id},method:"POST"}),a.upload.then((function(i){e.ufiles.push({filename:i.data.filename,savefilename:i.data.savefilename}),o++>=t.length&&(e.isRouteLoading=!1),p((function(){a.result=i.data}))}),(function(t){t.status>0&&(e.errorMsg=t.status+": "+t.data)}),(function(e){a.progress=Math.min(100,parseInt(100*e.loaded/e.total))}))}))},e.removeFile=function(t){r({url:l+"scripts/removefile.php",method:"POST",data:{filename:t}}).then((function(){!function(t){var a=e.ufiles.map((function(e){return e.savefilename})).indexOf(t);e.ufiles.splice(a,1)}(t)}))},e.publicEvents=function(e){return"VP"===e.outcome||"VN"===e.outcome||"UP"===e.outcome},e.publicArticle=function(e){t.open("#/events_public/articles/"+e,"_self")},e.getPublicEventsByID=function(){var t=localStorage.getItem("articleID");s.getEvents(t).then((function(t){var a=t.data;e.isRouteLoading=!1,e.eventsListPublic=a.EventsList;var o="Pending";"VP"==e.eventsListPublic.outcome?o="Verified (positive)":"VN"==e.eventsListPublic.outcome?o="Verified (negative)":"UV"==e.eventsListPublic.outcome?o="Unverified":"UP"==e.eventsListPublic.outcome?o="Updated (positive)":"NU"==e.eventsListPublic.outcome&&(o="Updated (negative)"),e.cd=e.eventsListPublic.history[0].date,e.closureDate=e.cd.split(" ")[0],e.od=e.eventsListPublic.create_date,e.openDate=e.od.split(" ")[0],e.event_outcome=o,e.eventTitle=e.eventsListPublic.title,e.phe_description=e.eventsListPublic.phe_description,e.phe_additional=e.eventsListPublic.phe_additional,e.initialSource=e.eventsListPublic.source+" : "+e.eventsListPublic.source_details}))},e.getEvents2=function(t){if(e.isRouteLoading=!1,a.dashboardType=t,"PR"==t&&!e.eventsListPublic){e.isRouteLoading=!0;var o=moment().format("YYYY-MM-DD"),i=moment().subtract(2,"months").format("YYYY-MM-DD");s.getEvents(e.id,i,o).then((function(t){var a=t.data;e.isRouteLoading=!1,e.eventsListPublic=a.EventsList,e.eventsListPublic.purpose&&(e.outcomePublic={},e.outcomePublic.phe_purpose="N",e.eventsListPublic.purpose.indexOf("Verification")>=0?e.outcomePublic.phe_purpose="V":e.eventsListPublic.purpose.indexOf("Update")>=0&&(e.outcomePublic.phe_purpose="U"),e.summaryPublic={},e.summaryPublic.phe_title=e.eventsListPublic.title)}))}};var _=function(t,a){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"all";e.isRouteLoading=!0,e.eventsList=[],s.getEvents(e.id,t,a).then((function(t){var a=t.data;if(e.isRouteLoading=!1,void 0!==e.userinfo)e.isOrganization=!(e.userInfo.fetp_id>0),null!=a.EventsList&&(e.isAuthorizedToFollowup=!(e.userInfo.organization_id!=a.EventsList.org_requester_id&&!e.userInfo.superuser),e.changeStatusText="C"==a.EventsList.estatus?"Re open":"Close",e.changeStatusType="C"==a.EventsList.estatus?"reopen":"close",e.isAuthorizedFETP=!1,e.isRequester=a.EventsList.requester_id==e.userInfo.uid,null!=a.EventsList.fetp_ids&&-1!=a.EventsList.fetp_ids.indexOf(e.userInfo.fetp_id)&&(e.isAuthorizedFETP=!0),a.EventsList.fetp_ids&&(e.num_fetp=a.EventsList.fetp_ids.length),e.eventsList=a.EventsList,e.filePreview=a.EventsList.filePreview?a.EventsList.filePreview:"","all"==i?(e.eventsList.all=a.EventsList.all,e.eventsList.other=a.EventsList.other):(a.EventsList.all&&(e.eventsList.all=a.EventsList.all.slice(0,i)),a.EventsList.other&&(e.eventsList.other=a.EventsList.other.slice(0,i))),e.eventsList.purpose&&(e.outcome={},e.outcome.phe_purpose="N",e.eventsList.purpose.indexOf("Verification")>=0?e.outcome.phe_purpose="V":e.eventsList.purpose.indexOf("Update")>=0&&(e.outcome.phe_purpose="U"),e.summary={},e.summary.phe_title=e.eventsList.title,e.summary.phe_description=e.eventsList.phe_description,e.summary.phe_additional=e.eventsList.phe_additional,e.summary.outcome=e.eventsList.outcome));else if(void 0===e.userinfo){if(e.eventsList=a.EventsList,"all"!=i){var n=a.EventsList.all,s=[];n.forEach((function(t){e.publicEvents(t)&&s.push(t)})),e.eventsList.all=s.splice(0,i)}e.eventsList.purpose&&(e.outcome={},e.outcome.phe_purpose="N",e.eventsList.purpose.indexOf("Verification")>=0?e.outcome.phe_purpose="V":e.eventsList.purpose.indexOf("Update")>=0&&(e.outcome.phe_purpose="U"),e.summary={},e.summary.phe_title=e.eventsList.title)}var c=new Date,d=c.getDate(),u=c.getMonth(),p=c.getFullYear();if(e.today_date=d+"-"+["January","February","March","April","May","June","July","August","September","October","November","December"][u]+"-"+p,e.response_text="",o.response_id){var m={};m.uid=e.userInfo.uid,m.org_id=e.userInfo.organization_id,m.fetp_id=e.userInfo.fetp_id,m.response_id=o.response_id,r({url:l+"scripts/getresponse.php",method:"POST",data:m}).then((function(t){var a=t.data;e.response_text=a.response,e.responder_id=a.responder_id,e.permission_id=a.response_permission_id}))}if(e.onOpen)e.listofEventIdsToDisplay=a.numNotRatedResponses?a.numNotRatedResponses[1][0]:[],e.num_notrated_responses=a.numNotRatedResponses?a.numNotRatedResponses[0]:0,e.rfiOrderByValue="iso_create_date";else if(e.eventsList)for(var f in e.rfiOrderByValue="iso_action_date",e.eventsList.yours)e.num_notrated_responses+=parseInt(e.eventsList.yours[f].num_notrated_responses);for(var h in e.eventsList.history)"0"!==e.eventsList.history[h].permission&&"Member Response"==e.eventsList.history[h].type&&e.userInfo.uid&&e.validResponses++;for(var h in e.activeSearch=!1,e.eventsList.history)"4"==e.eventsList.history[h].permission&&"Member Response"==e.eventsList.history[h].type&&e.eventsList.history[h].fetp_id==e.userInfo.fetp_id&&(e.activeSearch=!0);Date.prototype.yyyymmdd=function(){var e=this.getFullYear().toString(),t=(this.getMonth()+1).toString(),a=this.getDate().toString();return e+"-"+(t[1]?t:"0"+t[0])+"-"+(a[1]?a:"0"+a[0])};var v=new Date;for(var f in e.date=v.setDate(v.getDate()-14),e.unclosed=0,e.eventsList.yours)e.eventsList.yours[f].num_followups[0].iso_date<v.yyyymmdd()&&e.unclosed++;e.isRouteLoading=!1,e.eventsListAll=angular.copy(e.eventsList.all)}))};if(e.showNotScoredEvents=function(){e.eventsList.all&&(e.isShowNotScoredEvents=!e.isShowNotScoredEvents,e.isShowNotScoredEvents?e.eventsList.all=e.eventsList.all.filter((function(e){return!e.metric_score})):e.eventsList.all=e.eventsListAll)},!e.publicDashboard||!e.isPublicArticleView){if(e.publicDashboard){var g=moment().format("YYYY-MM-DD"),b=moment().subtract(3,"months").format("YYYY-MM-DD");_(b,g,10)}else e.onOpen?_(m,moment().add(1,"days").format("YYYY-MM-DD")):(g=moment().format("YYYY-MM-DD"),b=moment().subtract(1,"months").format("YYYY-MM-DD"),_(b,g,10));e.displaySavingText=!1;var D,y={};e.updateRFIMetrics=function(t,a){if("metric_score"!==t||a.metric_score||a.metric_score>2){var o={event_metrics_id:a.event_metrics_id,score:a.metric_score,creation:a.metric_creation,notes:a.metric_notes,action:a.metric_action,event_id:a.event_id};angular.equals(o,y)||(y=o,e.displaySavingText=!0,D&&p.cancel(D),D=p((function(){r({url:l+"scripts/updatemetrics.php",method:"POST",data:o}).then((function(){e.displaySavingText=!1}),(function(){e.displaySavingText=!1}))}),1e3))}else alert("Score cannot be more than 2")},e.sendFollowup=function(t,a){if(a){if(e.submitDisabled=!0,t.uid=e.userInfo.uid,t.event_id=o.id,t.superuser=e.userInfo.superuser?1:0,o.id)var i=o.id;o.response_id&&(t.response_id=o.response_id),r({url:l+"scripts/sendfollowup2.php",method:"POST",data:t}).then((function(){e.submitDisabled=!1,n.path("/success/3/"+i)}))}},e.changeRequestStatus=function(t,a,i){var s=[],c=[],d=[];if(i&&("Close"==a||"Update"==a)&&e.validResponses>0)for(var u in e.eventsList.history){var p=e.eventsList.history[u].response_id,m=e.eventsList.history[u].type,f=e.eventsList.history[u].fetp_id,h=e.eventsList.history[u].organization_id,v=e.eventsList.history[u].useful,_=e.eventsList.history[u].permission;if("Member Response"==m&&"0"!==_&&"4"!==_&&(e.userInfo.uid||f==e.userInfo.fetp_id)&&(h==e.userInfo.organization_id||e.userInfo.superuser)){if(null===v)return alert("Please assess all member responses."),e.close_message="Please assess all member responses.",!1;"1"===v?s.push(p):"2"===v?c.push(p):d.push(p)}}i&&(e.submitDisabled=!0,t.event_id=o.id,t.uid=e.userInfo.uid,t.superuser=e.userInfo.superuser,t.thestatus=a,t.useful_rids=s.toString(),t.usefulpromed_rids=c.toString(),t.notuseful_rids=d.toString(),"Close"==a?(t.phe_outcome=e.outcome.answer,t.phe_title=e.summary.phe_title,t.phe_description=e.summary.phe_description,t.phe_additional=e.summary.phe_additional):"Summary"==a&&(t.phe_outcome=e.summary.outcome,t.phe_title=e.summary.phe_title,t.phe_description=e.summary.phe_description,t.phe_additional=e.summary.phe_additional),t.condition_details=e.eventsList.condition_details,r({url:l+"scripts/changestatus2.php",method:"POST",data:t}).then((function(t){var o=t.data;if("success"===o.status){e.submitDisabled=!1;var i;i="Update"==a?8:"Reopen"==a?5:"Summary"==a?9:4,n.path("/success/"+i)}else alert(o.reason)})))},e.sendResponse=function(t,a){var i=void 0!==t.source;if(e.response_error_message="",0==t.response_permission||4==t.response_permission||a&&i){if(e.submitDisabled=!0,t.event_id=o.id,t.fetp_id=e.userInfo.fetp_id,o.id)var s=o.id;t.files=e.ufiles,r({url:l+"scripts/sendresponse2.php",method:"POST",data:t}).then((function(t){"success"===t.data.status?n.path("/success/2/"+s):alert("response failed!"),e.submitDisabled=!1}))}else a&&!i&&(e.response_error_message="missing verification sources")},e.deleteEvent=function(t){confirm("Are you sure you want to delete this event?")&&(data={eid:t,superuser:e.userInfo.superuser},r({url:l+"scripts/deleteEvent2.php",method:"POST",data}).then((function(e){var t=e.data;"success"===t.status?n.path("/success/7"):alert(t.reason)})))},e.showModal=!1,e.modalTitle="",e.modalBody="",e.showSummary=function(t,a,o,i,n,r,s){var l="";"MR"==i?l="Media Report":"OR"==i?l="Official Report":"OC"==i&&(l="Other communication");var c="Pending";"VP"==r?c="Verified (positive)":"VN"==r?c="Verified (negative)":"UV"==r?c="Unverified":"UP"==r?c="Updated (positive)":"NU"==r&&(c="Updated (negative)");var d="Title: "+o+"\r\n\r\nInitial Source: "+l+":"+n+"\r\n\r\nRFI Outcome: "+c+"\r\n\r\n";e.modalTitle="Summary",e.modalBody="",a?e.modalBody=d+"RFI Closure Date: "+s+"\r\n\r\nPHE Description:\r\n"+t+"\r\n\r\nAdditional Info:\r\n"+a:t&&(e.modalBody=d+"RFI Closure Date: "+s+"\r\n\r\nPHE Description:\r\n"+t),e.showModal=!e.showModal}}};g.$inject=["$scope","$window","$rootScope","$routeParams","$cookieStore","$location","$http","eventAPIservice2","urlBase","epicoreMode","epicoreVersion","Upload","$timeout","epicoreStartDate"];const b=g;var D=function(e,t){e.userInfo=t.get("epiUserInfo")};D.$inject=["$scope","$cookieStore"];const y=D;var S=function(e,t){e.isActive=function(e){return e===t.path()}};S.$inject=["$scope","$location"];const w=S;var I=function(e,t,a,o){e.userInfo=a.get("epiUserInfo"),e.isOrganization=e.userInfo.isOrganization,e.showpage=!1,e.map={center:{latitude:15,longitude:18},zoom:2},e.options={scrollwheel:!0},e.$on("$viewContentLoaded",(function(){$("#member-map .angular-google-map-container").height(500)})),e.markers=[],e.numMembers="",t({url:o+"scripts/getallmarkers.php",method:"POST"}).then((function(t){var a=t.data;"success"===a.status&&(e.markers=a.markers,e.showpage=!0,e.numMembers=e.markers.length,e.country_members=a.country_members,e.numCountries=Object.keys(e.country_members).length)}))};I.$inject=["$scope","$http","$cookieStore","urlBase"];const P=I;var L=function(e,t,a,o,i){function n(t){a({url:o+"scripts/getlocations.php",method:"POST",data:{fetp_id:t}}).then((function(t){var a=t.data;"success"===a.status?e.locations=a.locations:(e.message="",e.error_message=a.message,i((function(){e.error_message=""}),2e3))}))}e.userInfo=t.get("epiUserInfo"),e.locationaccess=void 0!==e.userInfo.locations&&e.userInfo.locations,e.fetp_id=void 0!==e.userInfo.fetp_id&&e.userInfo.fetp_id,e.showpage=!0,e.message="",e.error_message="",e.locationOptions={types:["(regions)"]},e.memLocationPlace={address_components:[],formatted_address:"",geometry:[]},e.member={city:"",state:"",countrycode:"",lat:"",long:""},e.memLocationChange=function(t){var a=[];t.address_components.forEach((function(t){-1!==t.types.indexOf("country")&&(e.member.countrycode=t.short_name),t.types.filter((function(e){-1!==e.indexOf("administrative_area")&&a.push(t.short_name)})),-1!==t.types.indexOf("locality")&&(e.member.city=t.short_name)})),e.member.state=a.toString().replace(/,/g,", "),t.geometry&&t.geometry.location&&(e.member.long=t.geometry.location.lng(),e.member.lat=t.geometry.location.lat())},e.addLocation=function(t){if(void 0===e.member.countrycode)return e.error_message="Please select a country.",!1;if(void 0===e.member.city)return e.error_message="Please select a city.",!1;if(void 0===e.member.state)return e.error_message="Please select a state.",!1;var r={city:e.member.city,state:e.member.state,countrycode:e.member.countrycode,fetp_id:e.fetp_id,latitude:e.member.lat,longitude:e.member.long};a({url:o+"scripts/addlocation.php",method:"POST",data:r}).then((function(t){var a=t.data;"success"===a.status?(e.message="Successfully added new location",e.error_message="",i((function(){e.message=""}),2e3),e.locations=n(e.fetp_id)):(e.message="",e.error_message=a.message,i((function(){e.error_message=""}),2e3))}))},e.locations=n(e.fetp_id),e.deleteLocation=function(t){a({url:o+"scripts/deletelocation.php",method:"POST",data:{location_id:t}}).then((function(t){var a=t.data;"success"===a.status?(e.message=a.message,e.locations=n(e.fetp_id),i((function(){e.message=""}),2e3)):(e.message="",e.error_message=a.message,i((function(){e.error_message=""}),2e3))}))}};L.$inject=["$scope","$cookieStore","$http","urlBase","$timeout"];const M=L;var C=function(e){e.date_now=Date.now();var t=new Date;e.year=t.getFullYear();var a=t.getMonth()-1;0==t.getMonth()&&(a=11,e.year=e.year-1),e.month=["January","February","March","April","May","June","July","August","September","October","November","December"][a]};C.$inject=["$scope"];const T=C;var U=function(e,t,a,o){e.showpage=!1,e.userInfo=t.get("epiUserInfo"),e.superuser=void 0!==e.userInfo&&e.userInfo.superuser,e.message="",1!=e.superuser?a({url:o+"scripts/approveaccess.php",method:"POST",data:{}}).then((function(){e.showpage=!0})):e.showpage=!0,e.addMod=function(t,i){a({url:o+"scripts/addmod.php",method:"POST",data:{mod_email:t,mod_org_id:i}}).then((function(t){var a=t.data;"success"===a.status?e.message="Successfully added new moderator":e.message=a.message}))},e.mods="",a({url:o+"scripts/getmods.php",method:"POST"}).then((function(t){var a=t.data;"success"===a.status&&(e.mods=a.mods)}))};U.$inject=["$scope","$cookieStore","$http","urlBase"];const R=U;var A=function(e,t){e.newsLinksJson={},e.newsLinksLatest={},t.getPdfURLS().then((function(t){var a=t.data;e.newsLinksJson=a,e.newsLinksLatest=a[0]}))};A.$inject=["$scope","newsService"];const E=A;var O=function(e,t){e.articleOutput=t.articleOutput,e.eventTitle=t.eventTitle,e.initialSource=t.initialSource,e.articleSourceDetails=t.articleSourceDetails,e.rfiOutcome=t.rfiOutcome,e.eventInfo=t.eventInfo,e.closureDate=t.closureDate};O.$inject=["$scope","$window"];const k=O;var Y=function(e,t){e.articleTitle="",e.articleBody="",e.openPortfolioURL=function(a,o,i,n,r,s,l,c){var d="";"MR"==r?d="Media Report":"OR"==r?d="Official Report":"OC"==r&&(d="Other communication");var u="Pending";"VP"==l?u="Verified (positive)":"VN"==l?u="Verified (negative)":"UV"==l?u="Unverified":"UP"==l?u="Updated (positive)":"NU"==l&&(u="Updated (negative)"),e.eventTitle=n,e.initialSource=d,e.articleSourceDetails=s,e.rfiOutcome=u,e.eventInfo=p,e.closureDate=c;var p="Title: "+n+"\r\n\r\nInitial Source: "+d+":"+s+"\r\n\r\nRFI Outcome: "+u+"\r\n\r\n";e.articleTitle="Summary",e.articleBody="",e.additionalInfo=i,(i||o)&&(e.articleBody="PHE Description:\r\n"+o);var m=t.open("#/events_public/articles/"+a,"_self");m.eventTitle=e.eventTitle,m.initialSource=e.initialSource,m.articleSourceDetails=e.articleSourceDetails,m.rfiOutcome=e.rfiOutcome,m.eventInfo=e.eventInfo,m.closureDate=e.closureDate,m.articleOutput=e.articleBody,localStorage.clear(),localStorage.setItem("local_eventTitle",e.eventTitle),localStorage.setItem("local_initialSource",e.initialSource),localStorage.setItem("local_articleSourceDetails",e.articleSourceDetails),localStorage.setItem("local_rfiOutcome",e.rfiOutcome),localStorage.setItem("local_eventInfo",e.eventInfo),localStorage.setItem("local_closureDate",e.closureDate),localStorage.setItem("local_articleOutput",e.articleBody),localStorage.setItem("local_additionalInfo",e.additionalInfo)}};Y.$inject=["$scope","$window"];const x=Y;var F=function(e,t,a,o,i,n,r,s){if(a.userInfo=e.userInfo=i.get("epiUserInfo"),t.sessionStorage.length>0&&(a.formData={},a.formData.title=t.sessionStorage.title,a.formData.additionalText=t.sessionStorage.additionalText,a.formData.description=t.sessionStorage.description,a.formData.location=t.sessionStorage.location,a.formData.disease=t.sessionStorage.disease,a.formData.latlon=t.sessionStorage.latlon),a.alertid=o.alertid,a.alertid&&a.alertid!==t.sessionStorage.alertid){t.sessionStorage.alertid=a.alertid;var l={};l.alert_id=a.alertid,r({url:s+"scripts/getalert.php",method:"POST",data:l}).then((function(e){var o=e.data;a.formData=o,a.formData.additionalText="",t.sessionStorage.title=o.title,t.sessionStorage.description=o.description,t.sessionStorage.location=o.location,t.sessionStorage.latlon=o.latlon,t.sessionStorage.disease=o.disease,t.sessionStorage.species=o.species,t.sessionStorage.additionalText="";var i=o.arabic_text;if(""!=i){var n=o.description;n=n.replace("<http://www.isid.org>","<http://www.isid.org>\n\n"+i+"\n"),t.sessionStorage.description=n,a.formData.description=n}}))}if(a.storeEvent=function(e,o){if(o){if(e.latlon=$("#default_location").val(),e.location=$("#searchTextField").val(),!e.latlon)return alert("Geolocation failed - please scroll down and select a location from the auto-suggester in the location field so that we have the coordinates of the event."),a.formData.location="",!1;t.sessionStorage.title=e.title,t.sessionStorage.description=e.description,t.sessionStorage.disease=e.disease,t.sessionStorage.additionalText=e.additionalText?e.additionalText:"",t.sessionStorage.searchBox&&t.sessionStorage.location==e.location?n.path("/request2"):(t.sessionStorage.location=e.location,t.sessionStorage.latlon=e.latlon,r({url:s+"scripts/filter.php",method:"POST",data:e}).then((function(e){var a=e.data;t.sessionStorage.userIds=a.userIds,t.sessionStorage.numFetps=a.userList.sending,t.sessionStorage.numUniqueFetps=a.uniqueList.sending,t.sessionStorage.searchBox=a.bbox,t.sessionStorage.searchType="radius",n.path("/request2")})))}},a.numFetps=t.sessionStorage.numFetps,a.numUniqueFetps=t.sessionStorage.numUniqueFetps,a.filePreview=t.sessionStorage.filePreview,"/request2"==n.path()||"/members"==n.path()){"country"==t.sessionStorage.searchType?(a.radiussel=!1,a.formData.countries=t.sessionStorage.countries.split(",")):a.radiussel=!0,a.submitDisabled=!(a.numFetps>0),a.bbox=t.sessionStorage.searchBox.split(",");var c=new google.maps.LatLngBounds(new google.maps.LatLng(a.bbox[0],a.bbox[2]),new google.maps.LatLng(a.bbox[1],a.bbox[3]));a.rectangle={bounds:c,stroke:{color:"#08B21F",weight:2,opacity:1},fill:{color:"#08B21F",opacity:.5},editable:!0,visible:!0};var d=t.sessionStorage.latlon.split(",");a.map={center:{latitude:d[0],longitude:d[1]},zoom:5},a.options={scrollwheel:!1};var u={};u.uid=a.userInfo.uid,u.centerlat=d[0],u.centerlon=d[1],r({url:s+"scripts/getmarkers.php",method:"POST",data:u}).then((function(e){var t=e.data;"success"===t.status&&(a.markers=t.markers)})),a.eventsRectangle={bounds_changed:function(e){var o={},i=e.bounds.getSouthWest(),n=e.bounds.getNorthEast();a.radiussel=!0,t.sessionStorage.searchType="radius",o.bbox=new Array(i.lat(),n.lat(),i.lng(),n.lng()),r({url:s+"scripts/filter.php",method:"POST",data:o}).then((function(e){var o=e.data;t.sessionStorage.searchBox=o.bbox,t.sessionStorage.userIds=o.userIds,t.sessionStorage.numFetps=a.numFetps=o.userList.sending,t.sessionStorage.numUniqueFetps=a.numUniqueFetps=o.uniqueList.sending,a.submitDisabled=!(a.numFetps>0)}))}}}a.recalcUsers=function(e,o){t.sessionStorage.searchType=e.filtertype=o,"country"==o?(a.radiussel=!1,t.sessionStorage.countries=e.countries):(e.bbox=t.sessionStorage.searchBox.split(","),a.radiussel=!0),r({url:s+"scripts/filter.php",method:"POST",data:e}).then((function(e){var o=e.data;t.sessionStorage.userIds=o.userIds,t.sessionStorage.numFetps=a.numFetps=o.userList.sending,t.sessionStorage.numUniqueFetps=a.numUniqueFetps=o.uniqueList.sending,a.submitDisabled=!(a.numFetps>0),o.bbox&&(t.sessionStorage.searchBox=o.bbox)}))},a.buildEmailText=function(){var e={};e.additionalText=t.sessionStorage.additionalText,e.title=t.sessionStorage.title,e.location=t.sessionStorage.location,e.description=t.sessionStorage.description,void 0!==t.sessionStorage.filePreview&&(e.file_preview=t.sessionStorage.filePreview),r({url:s+"scripts/buildrequest.php",method:"POST",data:e}).then((function(e){var a=e.data;t.sessionStorage.filePreview=a.file_preview,n.path("/request3")}))},a.sendRequest=function(){a.submitDisabled=!0;var e={};"radius"==t.sessionStorage.searchType?e.search_box=t.sessionStorage.searchBox:e.search_countries=t.sessionStorage.countries,e.uid=a.userInfo.uid,e.fetp_ids=t.sessionStorage.userIds,e.latlon=t.sessionStorage.latlon,e.location=t.sessionStorage.location,e.title=t.sessionStorage.title,e.description=t.sessionStorage.description,e.additionalText=t.sessionStorage.additionalText,e.disease=t.sessionStorage.disease,e.alert_id=t.sessionStorage.alertid,r({url:s+"scripts/sendrequest.php",method:"POST",data:e}).then((function(){t.sessionStorage.clear(),n.path("/success/3"),a.submitDisabled=!1}))},a.clearRequest=function(){confirm("Are you sure you want to clear this request form?")&&(a.formData={},t.sessionStorage.title="",t.sessionStorage.description="",t.sessionStorage.location="",t.sessionStorage.latlon="",t.sessionStorage.additionalText="",t.sessionStorage.disease="",t.sessionStorage.species="",t.sessionStorage.alertid="")}};F.$inject=["$rootScope","$window","$scope","$routeParams","$cookieStore","$location","$http","urlBase"];const q=F;var B=function(e,t,a,o,i,n,r,s,l,c){if(a.userInfo=e.userInfo=i.get("epiUserInfo"),a.epicore_version=c,a.rfiData=l.get(),o.id){a.rfiData.event_id=o.id;var d={};d.event_id=a.rfiData.event_id,r({url:s+"scripts/getrequest2.php",method:"POST",data:d}).then((function(e){var t=e.data;a.rfiData.location={},a.rfiData.health_condition={},a.rfiData.population={},a.rfiData.source={},a.rfiData.location.location=t.event.location,a.rfiData.location.event_date=t.event.event_date,a.rfiData.location.event_date_details=t.event.event_date_details,a.rfiData.location.latlon=t.event.latlon,a.rfiData.location.location_details=t.event.location_details,a.rfiData.additionalText=t.event.personalized_text,a.rfiData.population=t.population,a.rfiData.purpose=t.purpose,a.rfiData.health_condition=t.health_condition,a.rfiData.source=t.source,a.rfiData.place=t.event.location,a.isRequester=t.event.requester_id==a.userInfo.uid}))}a.autocompleteOptions={types:["(regions)"]};var u=function(e){return e.geometry.location.lat()+","+e.geometry.location.lng()};function p(){a.submitDisabled=a.rfiData.members.numFetps<=0,a.bbox=a.rfiData.members.searchBox;var e=new google.maps.LatLngBounds(new google.maps.LatLng(a.bbox[0],a.bbox[2]),new google.maps.LatLng(a.bbox[1],a.bbox[3]));a.rectangle={bounds:e,stroke:{color:"#08B21F",weight:2,opacity:1},fill:{color:"#08B21F",opacity:.5},editable:!0,visible:!0};var t=a.rfiData.members.latlon.split(",");a.map={center:{latitude:t[0],longitude:t[1]},zoom:5},a.options={scrollwheel:!1};var o={};o.uid=a.userInfo.uid,o.centerlat=t[0],o.centerlon=t[1],r({url:s+"scripts/getmarkers.php",method:"POST",data:o}).then((function(e){var t=e.data;"success"===t.status&&(a.markers=t.markers)})),a.eventsRectangle={bounds_changed:function(e){var t={},o=e.bounds.getSouthWest(),i=e.bounds.getNorthEast();a.radiussel=!0,a.rfiData.members.searchType="radius",t.bbox=new Array(o.lat(),i.lat(),o.lng(),i.lng()),r({url:s+"scripts/filter.php",method:"POST",data:t}).then((function(e){var t=e.data;a.rfiData.members.searchBox=t.bbox,a.rfiData.members.userIds=t.userIds,a.rfiData.members.numFetps=a.numFetps=t.userList.sending,a.rfiData.members.numUniqueFetps=a.numUniqueFetps=t.uniqueList.sending,a.submitDisabled=a.rfiData.members.numFetps<=0}))}}}a.location_error_message="",a.saveLocation=function(e){if(null!=$("#autocompleteText").val()&&""!=$("#autocompleteText").val()&&(a.rfiData.location.latlon=u(a.rfiData.place),a.rfiData.location.location=$("#autocompleteText").val(),!a.rfiData.location.latlon))return a.rfiData.location.location_error_message="Geolocation failed - please scroll down and select a location from the auto-suggester in the location field so that we have the coordinates of the event.",a.rfiData.location.location="",!1;if(a.rfiData.location.location){var t=a.rfiData.location.location.split(",");4==t.length?(a.rfiData.default_city=t[1],a.rfiData.default_state=t[2],a.rfiData.default_country=t[3],a.rfiData.location.location=t[1]+","+t[2]+","+t[3]):3==t.length?(a.rfiData.default_city=t[0],a.rfiData.default_state=t[1],a.rfiData.default_country=t[2]):2==t.length?(a.rfiData.default_city="",a.rfiData.default_state=t[0],a.rfiData.default_country=t[1]):1==t.length&&(a.rfiData.default_city="",a.rfiData.default_state="",a.rfiData.default_country=t[0])}if(a.rfiData.location.latlon&&a.rfiData.location.location){if("next"===e&&!a.rfiData.event_id)if(void 0===a.rfiData.members||a.rfiData.members.location!=a.rfiData.location.location){a.rfiData.members={},a.rfiData.members.userIds=[],a.rfiData.members.numFetps=0,a.rfiData.members.numUniqueFetps=0,a.rfiData.members.searchBox=[],a.rfiData.members.searchType="none",a.rfiData.members.location=a.rfiData.location.location,a.rfiData.members.display_location="("+$("#autocompleteText").val()+")",a.rfiData.members.latlon=a.rfiData.location.latlon;var o={};o.location=a.rfiData.members.location,o.latlon=a.rfiData.members.latlon,r({url:s+"scripts/filter.php",method:"POST",data:o}).then((function(e){var t=e.data;a.rfiData.members.userIds=t.userIds,a.rfiData.members.numFetps=t.userList.sending,a.rfiData.members.numUniqueFetps=t.uniqueList.sending,a.rfiData.members.searchBox=t.bbox,a.rfiData.members.searchType="radius",p()}))}else p();a.location_error_message=""}else a.location_error_message="Missing parameters above."},a.recalcUsers=function(e){a.saveLocation("next"),a.rfiData.members.searchType=e,a.rfiData.members.displayCountries=e,a.rfiData.members.filtertype=e,a.radiussel="country"!=e,r({url:s+"scripts/filter.php",method:"POST",data:a.rfiData.members}).then((function(e){var t=e.data;a.rfiData.members.userIds=t.userIds,a.rfiData.members.numFetps=t.userList.sending,a.rfiData.members.numUniqueFetps=t.uniqueList.sending,a.submitDisabled=a.rfiData.members.numFetps<=0,t.bbox&&(a.rfiData.members.searchBox=t.bbox)}))},a.saveMembers=function(e){"next"===e?n.path("/time"):"back"===e&&n.path("/location")},a.sourceDetailsError="Please fill the details above",a.source_error_message="How did you hear about this event is a required field.",a.isStep1Invalid=!1,a.saveStep1=function(e){var t;a.submitDisabled=!1,a.isStep1Invalid=!1,a.rfiData.place||(a.location_error_message="Enter an event location",a.isStep1Invalid=!0),a.rfiData.location&&a.rfiData.location.event_date||(a.time_error_message="Enter a valid date.",a.isStep1Invalid=!0),a.rfiData.source||(a.isStep1Invalid=!0),a.rfiData.event_id||a.rfiData.members&&a.rfiData.members.filtertype||(a.submitDisabled=!0),a.rfiData.place&&a.rfiData.location&&a.rfiData.location.location!==$("#autocompleteText").val()&&(a.rfiData.location.latlon=u(a.rfiData.place),a.rfiData.location.location=$("#autocompleteText").val(),a.rfiData.location.latlon||(a.rfiData.location.location_error_message="Geolocation failed - please scroll down and select a location from the auto-suggester in the location field so that we have the coordinates of the event.",a.rfiData.location.location="",a.isStep1Invalid=!0)),a.rfiData.location&&a.rfiData.location.location&&(4==(t=a.rfiData.location.location.split(",")).length?(a.rfiData.default_city=t[1],a.rfiData.default_state=t[2],a.rfiData.default_country=t[3],a.rfiData.location.location=t[1]+","+t[2]+","+t[3]):3==t.length?(a.rfiData.default_city=t[0],a.rfiData.default_state=t[1],a.rfiData.default_country=t[2]):2==t.length?(a.rfiData.default_city="",a.rfiData.default_state=t[0],a.rfiData.default_country=t[1]):1==t.length&&(a.rfiData.default_city="",a.rfiData.default_state="",a.rfiData.default_country=t[0])),"country"!==a.filtertype||a.rfiData.members.countries||(a.isStep1Invalid=!0),a.rfiData.source&&a.rfiData.source.source&&!a.rfiData.source.details&&(a.isStep1Invalid=!0),a.isStep1Invalid||"next"!==e||(n.path("/rfi_step2"),a.time_error_message="")},a.populationOtherError="",a.affectedPopSelectionError="",a.healthDetailsError="",a.hc_error_message="",a.hc_error_message1="",a.populationAnimalError="",a.populationAnimalOtherError="",a.saveStep2=function(e){a.isStep2Invalid=!1,a.populationOtherError="",a.affectedPopSelectionError="",a.healthDetailsError="",a.hc_error_message="",a.hc_error_message1="","next"===e?(a.rfiData.population||(a.affectedPopSelectionError="Please select the affected population from above",a.isStep2Invalid=!0),a.rfiData.population&&("E"!=a.rfiData.population.type&&"U"!=a.rfiData.population.type||a.rfiData.population.other||(a.populationOtherError="Please fill the details above",a.isStep2Invalid=!0),"A"!=a.rfiData.population.type||a.rfiData.population.animal_type||(a.populationAnimalError="Please fill the details above",a.isStep2Invalid=!0),"O"!==a.rfiData.population.animal_type||a.rfiData.population.other_animal||(a.populationAnimalOtherError="Please fill the details above",a.isStep2Invalid=!0)),!a.rfiData.health_condition&&a.rfiData.population&&("E"!=a.rfiData.population.type&&"U"!=a.rfiData.population.type||a.rfiData.health_condition&&("E"!=a.rfiData.population.type&&"U"!=a.rfiData.population.type||(a.rfiData.health_condition.unknown=!1,a.rfiData.health_condition.other=!1,a.rfiData.health_condition.unknown_animal=!1,a.rfiData.health_condition.other_animal=!1,a.rfiData.health_condition.other_description="",a.rfiData.health_condition.other_animal_description=""))),a.rfiData.health_condition||(a.hc_error_message1="Missing parameters above.",a.isStep2Invalid=!0),a.rfiData.health_condition&&!a.rfiData.health_condition.disease_details&&(a.healthDetailsError="Please fill the details above.",a.isStep2Invalid=!0),a.rfiData.health_condition&&a.rfiData.health_condition.other_animal&&!a.rfiData.health_condition.other_animal_description&&(a.healthDetailsOtherError="Please fill the details above.",a.isStep2Invalid=!0),a.rfiData.health_condition&&a.rfiData.health_condition.other&&!a.rfiData.health_condition.other_description&&(a.healthDetailsOtherError="Please fill the details above.",a.isStep2Invalid=!0),a.isStep2Invalid||n.path("/rfi_step3")):"back"===e&&n.path("/rfi_step1")},$("#datepicker").datepicker({format:"dd-MM-yyyy",endDate:"now",startDate:"-1y"}),a.time_error_message="",a.saveTime=function(e){"back"===e||a.rfiData.location.event_date?("next"===e?n.path("/population"):"back"!==e||a.rfiData.event_id?"back"===e&&a.rfiData.event_id&&n.path("/location"):n.path("/members"),a.time_error_message=""):a.time_error_message="Missing parameters above."},a.pop_error_message="",a.savePopulation=function(e){if(a.goback="back"===e,"back"===e)a.rfiData.event_id?n.path("/members"):n.path("/time");else{var t="O"!=a.rfiData.population.animal_type||a.rfiData.population.other_animal,o="A"!=a.rfiData.population.type||a.rfiData.population.animal_type&&t,i="E"!=a.rfiData.population.type&&"U"!=a.rfiData.population.type||a.rfiData.population.other;a.rfiData.population.type&&i&&o?("next"===e&&(!function(e){if(e)n.path("/condition");else{var t={};t.population_type=a.rfiData.population.type,t.location=a.rfiData.location.location,r({url:s+"scripts/checkDuplicateRFI2.php",method:"POST",data:t}).then((function(e){var t=e.data,o=t.events;"success"===t.status&&o?(a.rfiData.duplicate_rfis=o,a.rfiData.duplicate_rfi={},n.path("/duplicate")):"notfound"==t.status?n.path("/condition"):alert(t.message)}))}}(a.userInfo.superuser&&!a.isRequester),n.path("/condition")),a.pop_error_message=""):a.pop_error_message="Missing parameters above."}},a.hc_error_message="",a.hc_error_message1="",a.saveCondition=function(e){if(a.goback="back"===e,"back"===e)n.path("/population");else{var t=!a.rfiData.health_condition.other||a.rfiData.health_condition.other_description,o=(a.rfiData.health_condition.respiratory||a.rfiData.health_condition.gastrointestinal||a.rfiData.health_condition.fever_rash||a.rfiData.health_condition.jaundice||a.rfiData.health_condition.h_fever||a.rfiData.health_condition.paralysis||a.rfiData.health_condition.other_neurological||a.rfiData.health_condition.fever_unknown||a.rfiData.health_condition.renal||a.rfiData.health_condition.unknown||a.rfiData.health_condition.other)&&t,i=!a.rfiData.health_condition.other_animal||a.rfiData.health_condition.other_animal_description,r=(a.rfiData.health_condition.respiratory_animal||a.rfiData.health_condition.neurological_animal||a.rfiData.health_condition.hemorrhagic_animal||a.rfiData.health_condition.vesicular_animal||a.rfiData.health_condition.reproductive_animal||a.rfiData.health_condition.gastrointestinal_animal||a.rfiData.health_condition.multisystemic_animal||a.rfiData.health_condition.unknown_animal||a.rfiData.health_condition.other_animal)&&i,s=!("H"==a.rfiData.population.type&&!o||"A"==a.rfiData.population.type&&!r);"back"===e||s&&a.rfiData.health_condition.disease_details?("next"===e?n.path("/purpose"):"back"===e&&n.path("/population"),a.hc_error_message="",a.hc_error_message1=""):s?(a.hc_error_message="Missing parameters above.",a.hc_error_message1=""):(a.hc_error_message1=t&&i?"Must select one or more of the above options ":"",a.hc_error_message="Missing parameters above.")}},a.clearCondition=function(){a.rfiData.health_condition&&(a.rfiData.health_condition.respiratory=!1,a.rfiData.health_condition.gastrointestinal=!1,a.rfiData.health_condition.fever_rash=!1,a.rfiData.health_condition.jaundice=!1,a.rfiData.health_condition.h_fever=!1,a.rfiData.health_condition.paralysis=!1,a.rfiData.health_condition.other_neurological=!1,a.rfiData.health_condition.fever_unknown=!1,a.rfiData.health_condition.renal=!1)},a.clearCondition2=function(){a.rfiData.health_condition&&(a.rfiData.health_condition.respiratory_animal=!1,a.rfiData.health_condition.neurological_animal=!1,a.rfiData.health_condition.hemorrhagic_animal=!1,a.rfiData.health_condition.vesicular_animal=!1,a.rfiData.health_condition.reproductive_animal=!1,a.rfiData.health_condition.gastrointestinal_animal=!1,a.rfiData.health_condition.multisystemic_animal=!1)},a.clearhcError=function(){a.hc_error_message2=""},a.clearhcError2=function(){a.hc_error_message2=""},a.duplicateAction=function(){if("1"==a.rfiData.duplicate_rfi.rfi_same)confirm("Are sure? This will clear the RFI you have just entered.")&&(t.sessionStorage.clear(),l.clear(),n.path("/events2"));else if("2"==a.rfiData.duplicate_rfi.rfi_same){if(confirm("Are you sure?  This will clear the RFI you have just entered and you will receive all emails regarding the existing RFIs")){var e=a.userInfo.uid,o=a.rfiData.duplicate_rfis,i=[];o.forEach((function(e){i.push(e.event_id)})),r({url:s+"scripts/trackDuplicateRFI2.php",method:"POST",data:{event_ids:i,user_id:e}}).then((function(e){"success"===e.data.status&&(t.sessionStorage.clear(),l.clear(),n.path("/events2"))}))}}else"3"==a.rfiData.duplicate_rfi.rfi_same&&n.path("/condition")},a.purpose_error_message="",a.purpose_error_message1="",a.savePurpose=function(e){if(a.goback="back"===e,"back"===e)n.path("/condition");else{var t=a.rfiData.purpose.causal_agent||a.rfiData.purpose.epidemiology||a.rfiData.purpose.pop_affected||a.rfiData.purpose.location||a.rfiData.purpose.size||a.rfiData.purpose.test||a.rfiData.purpose.other_category,o=!a.rfiData.purpose.other_category||a.rfiData.purpose.other;"back"===e||t&&o&&a.rfiData.purpose.purpose?("next"===e?n.path("/source"):"back"===e&&n.path("/condition"),a.purpose_error_message="",a.purpose_error_message1=""):o?t?(a.purpose_error_message="Missing parameters above.",a.purpose_error_message1=""):(a.purpose_error_message="Missing parameters above.",a.purpose_error_message1="Must select one or more of the above options."):(a.purpose_error_message="Missing parameters above.",a.purpose_error_message1="")}},a.purpose_error_message1="",a.purpose_error_message="",a.saveStep3=function(e){if(a.purpose_error_message="",a.purpose_error_message1="","next"===e){if(a.saveLocation("next"),!a.rfiData.purpose||!a.rfiData.purpose.purpose)return void(a.purpose_error_message="Must select one of the above options.");if(void 0===a.rfiData.purpose.causal_agent&&void 0===a.rfiData.purpose.epidemiology&&void 0===a.rfiData.purpose.pop_affected&&void 0===a.rfiData.purpose.location&&void 0===a.rfiData.purpose.size&&void 0===a.rfiData.purpose.test&&void 0===a.rfiData.purpose.other_category)return void(a.purpose_error_message1="Must select atleast one of the above options.");a.rfiData.event_location=a.getLocation_2(),a.rfiData.event_population=a.getPopulation_2(),a.rfiData.event_conditions=a.getConditions_2()?a.getConditions_2().trim()+" - ":"",a.rfiData.event_conditions?a.rfiData.event_title=a.rfiData.event_population+" - "+a.rfiData.event_conditions+" - "+a.rfiData.event_location+" - "+a.rfiData.location.event_date:a.rfiData.event_title=a.rfiData.event_population+" - "+a.rfiData.event_location+" - "+a.rfiData.location.event_date,a.rfiData.event_purpose=a.getPurpose_2(),a.rfiData.event_source=a.getSource_2(),n.path("/sendrequest")}else"back"===e&&n.path("/rfi_step2")},a.getLocation_2=function(){var e="";return a.rfiData.default_city?e=" ("+a.rfiData.default_city+","+a.rfiData.default_state+")":a.rfiData.default_state&&(e=" ("+a.rfiData.default_state+")"),a.rfiData.default_country+e},a.getPopulation_2=function(){var e="";switch(a.rfiData.population.type){case"H":e="Human";break;case"A":e=function(){var e="";switch(a.rfiData.population.animal_type){case"B":e="Birds/Poultry";break;case"P":e="Pigs/Swine";break;case"C":e="Cattle";break;case"G":e="Goats/Sheep";break;case"D":e="Dogs/Cats";break;case"H":e="Horses/Equines";break;case"O":e=a.rfiData.population.other_animal}return e}();break;case"E":e="Environmental, "+a.rfiData.population.other;break;case"U":e=a.rfiData.population.other?a.rfiData.population.other:"Unknown";break;case"O":e=a.rfiData.population.other}return e},a.getConditions_2=function(){var e="";"H"==a.rfiData.population.type?e="human":"A"==a.rfiData.population.type?e="animal":"E"==a.rfiData.population.type?e="environment":"U"==a.rfiData.population.type&&(e="unknown");var t=[];return"human"==e?(a.rfiData.health_condition.respiratory&&t.push("Acute Respiratory"),a.rfiData.health_condition.gastrointestinal&&t.push("Gastrointestinal"),a.rfiData.health_condition.fever_rash&&t.push("Fever & Rash"),a.rfiData.health_condition.jaundice&&t.push("Acute Jaundice"),a.rfiData.health_condition.h_fever&&t.push("Hemorrhagic Fever"),a.rfiData.health_condition.paralysis&&t.push("Acute Flaccid paralysis"),a.rfiData.health_condition.other_neurological&&t.push("Other neurological"),a.rfiData.health_condition.fever_unknown&&t.push("Fever of unknown origin"),a.rfiData.health_condition.renal&&t.push("Renal failure"),a.rfiData.health_condition.unknown&&t.push("Unknown"),a.rfiData.health_condition.other&&t.push(a.rfiData.health_condition.other_description)):"animal"==e&&(a.rfiData.health_condition.respiratory_animal&&t.push("Respiratory"),a.rfiData.health_condition.neurological_animal&&t.push("Neurological"),a.rfiData.health_condition.hemorrhagic_animal&&t.push("Haemorrhagic"),a.rfiData.health_condition.vesicular_animal&&t.push("Vesicular"),a.rfiData.health_condition.reproductive_animal&&t.push("Reproductive"),a.rfiData.health_condition.gastrointestinal_animal&&t.push("Gastrointestinal"),a.rfiData.health_condition.multisystemic_animal&&t.push("Multisystemic"),a.rfiData.health_condition.unknown_animal&&t.push("Unknown"),a.rfiData.health_condition.other_animal&&t.push(a.rfiData.health_condition.other_animal_description)),t.toString()},a.getPurpose_2=function(){var e="V"==a.rfiData.purpose.purpose?"Verification":"Update",t=[];return a.rfiData.purpose.causal_agent&&t.push("PHE Causal Agent: "+e+" on identified/hypothetical causal agent"),a.rfiData.purpose.epidemiology&&t.push("PHE Epidemiology: "+e+" on the epidemiology including patterns of disease transmission, incubation period"),a.rfiData.purpose.pop_affected&&t.push("PHE population affected: "+e+" on involved population (e.g. human/animal) or specific community"),a.rfiData.purpose.location&&t.push("PHE Location: "+e+" on location of cases or locations at risk for disease spread"),a.rfiData.purpose.size&&t.push("PHE Size: "+e+" on number of cases  (suspected, confirmed, fatalities etc)"),a.rfiData.purpose.test&&t.push("PHE Test Results: "+e+" on test results"),a.rfiData.purpose.other_category&&t.push("Other: "+e+" on aspects not reflected in the other categories - "+a.rfiData.purpose.other),t},a.getSource_2=function(){return"MR"==a.rfiData.source.source?"Media Report":"OR"==a.rfiData.source.source?"Official Report":"OC"==a.rfiData.source.source?"Other Communication":"none"},a.filePreview=t.sessionStorage.filePreview,a.sendRFIButtonText="Send RFI",a.sendRequest2=function(e){if("next"===e){a.submitDisabled=!0,a.sendRFIButtonText="Please wait ....";var t={};if("radius"==a.rfiData.members.searchType?t.search_box=a.rfiData.members.searchBox.toString():t.search_countries=a.rfiData.members.countries.toString(),t.uid=a.userInfo.uid,t.fetp_ids=a.rfiData.members.userIds,t.population=a.rfiData.population,t.health_condition=a.rfiData.health_condition,t.health_condition_details=a.rfiData.health_condition.disease_details,t.location=a.rfiData.location,t.purpose=a.rfiData.purpose,t.source=a.rfiData.source,t.title=a.rfiData.event_title,t.additionalText=a.rfiData.additionalText,t.duplicate_rfi_detected=a.rfiData.duplicate_rfi&&"3"==a.rfiData.duplicate_rfi.rfi_same?1:0,t.duplicate_rfi_detected&&void 0!==a.rfiData.duplicate_rfis){var o=[];a.rfiData.duplicate_rfis.forEach((function(e){o.push({id:e.event_id,title:e.title})})),t.duplicate_events=o}r({url:s+"scripts/sendrequest2.php",method:"POST",data:t}).then((function(){n.path("/sent"),a.submitDisabled=!1}))}else"back"===e&&n.path("/rfi_step3")},a.updateRequest=function(e){if("next"===e){a.submitDisabled=!0;var o={};o.event_id=a.rfiData.event_id,o.uid=a.userInfo.uid,o.title=a.rfiData.event_title,o.location=a.rfiData.location,o.population=a.rfiData.population,o.health_condition=a.rfiData.health_condition,o.purpose=a.rfiData.purpose,o.source=a.rfiData.source,r({url:s+"scripts/updaterequest2.php",method:"POST",data:o}).then((function(e){e.data&&"success"===e.data.status&&(t.sessionStorage.clear(),l.clear(),n.path("/success/6")),a.submitDisabled=!1}),(function(e){console.error(e)}))}else"back"===e&&n.path("/rfi_step3")},a.sentRFI=function(){t.sessionStorage.clear(),l.clear(),n.path("/events2")},a.clearRequest=function(){confirm("Are you sure you want to clear this RFI?")&&(t.sessionStorage.clear(),l.clear(),n.path("/rfi_step1"))}};B.$inject=["$rootScope","$window","$scope","$routeParams","$cookieStore","$location","$http","urlBase","rfiForm","epicoreVersion"];const N=B;var G=function(e,t,a,o,i){e.userInfo=a.get("epiUserInfo");var n={};n.uid=e.userInfo.uid,n.org_id=e.userInfo.organization_id,n.fetp_id=e.userInfo.fetp_id,n.response_id=t.response_id,o({url:i+"scripts/getresponse.php",method:"POST",data:n}).then((function(t){var a=t.data;e.isAuthorizedToSee="failed"!=a.status,e.isAuthorizedToFollowup=!!a.authorized_to_followup,e.filePreview=a.filePreview?a.filePreview:"",e.responseObj=a}))};G.$inject=["$scope","$routeParams","$cookieStore","$http","urlBase"];const V=G;var z=function(e,t,a,o){e.userInfo=a.get("epiUserInfo"),e.epicore_version=o;e.id=t.id,e.eid=t.eid,e.messageResponse={},e.messageResponse.text={1:"You have been signed up.",2:'The moderator who initiated the request has been notified. If you get any information on this RFI in the future, please come back to this RFI and click on "Yes, respond to this RFI"',3:"Your RFI has been sent to the selected members.",4:"Your RFI has been closed and an email has gone out to the original members contacted.",5:"Your RFI has been reopened and an email has gone out to the original members contacted.",6:"Your RFI has been updated.",7:"Your RFI has been deleted.",8:"Your RFI responses have been updated.",9:"RFI summary has been updated."}[e.id]};z.$inject=["$scope","$routeParams","$cookieStore","epicoreVersion"];const H=z;var j=function(e,t,a,o,i){e.code1="LYgaHDL00x0",e.code2="0ZVnTS7Bo3A",e.passed=!1,e.grade=function(o){e.attempted=!0;var n=[];if("E"!=o.q1&&n.push("1"),"C"!=o.q2&&n.push("2"),"B"!=o.q3&&n.push("3"),"B"!=o.q4&&n.push("4"),"E"!=o.q5&&n.push("5"),""!=n)e.test_message="Missed question(s): "+n+".  Please take the test again.";else if(e.passed=!0,e.userInfo=t.get("epiUserInfo"),"P"==e.userInfo.status){var r={fetp_id:e.userInfo.fetp_id,status:"approved"};a({url:i+"scripts/approveUser.php",method:"POST",data:r}).then((function(a){"success"===a.data.status&&(e.test_message="You passed the test! <br><br> You can now login to the Epicore platform using your email and password.  Your certificate of recognition is available on the training page after you login.",e.passed=!0,e.userInfo.status="A",t.put("epiUserInfo",e.userInfo))}))}else e.test_message="You passed the test! <br><br> You can now login to the Epicore platform using your email and password. Your certificate of recognition is available on the training page after you login.",e.passed=!0}};j.$inject=["$scope","$cookieStore","$http","$location","urlBase"];const K=j;var J=function(e,t,a,o,i,n,r,s,l,c,d,u,p,m,f){a.mobile="mobile"==d,a.epicore_version=m,a.isRouteLoading=!1,a.autologin=!0;var h=r.search()?r.search():"";if(a.getClass=function(e){return e==r.path()?"active":""},a.go=function(e){r.path(e)},a.uid=t.id,a.action=t.action,a.idtype=t.idtype,a.uid&&"edit"==a.action){a.more_schools1=!0,a.more_schools2=!0;var v={};v.uid=a.uid,v.action=a.action,v.idtype=a.idtype,s({url:c+"scripts/getapplicant.php",method:"POST",data:v}).then((function(e){var t=e.data;a.uservals=t,a.uservals.university2?(a.more_schools1=!0,a.uservals.school_country2=t.school_country2):a.more_schools1=!1,a.uservals.university3?(a.more_schools2=!0,a.uservals.school_country3=t.school_country3):a.more_schools2=!1;var o={};a.userLocationPlace={address_components:[],formatted_address:""},t.city&&(o.long_name=t.city,o.short_name=t.city,a.userLocationPlace.address_components.push(o)),t.state&&(o.long_name=t.state,o.short_name=t.state,a.userLocationPlace.address_components.push(o)),t.country&&(o.long_name=t.country,o.short_name=t.country,a.userLocationPlace.address_components.push(o));var i=t.city+", "+t.state+" "+t.country;i&&(i=(i=i.replace(/null/g,"")).replace(/undefined/g,""),a.userLocationPlace.formatted_address=i.replace(/^,/g,""))}))}a.userInfo=e.userInfo=n.get("epiUserInfo"),a.countries=p,a.locationOptions={types:["(regions)"]},a.uservals={},a.userLocationChange=function(e){var t=[];e.address_components.forEach((function(e){-1!==e.types.indexOf("country")&&(a.uservals.country=e.short_name),e.types.filter((function(a){-1!==a.indexOf("administrative_area")&&t.push(e.short_name)})),-1!==e.types.indexOf("locality")&&(a.uservals.city=e.short_name)})),a.uservals.state=t.toString().replace(/,/g,", ")},a.mobile&&void 0!==u.username&&void 0!==u.password&&(a.formData={},a.formData.username=u.username,a.formData.password=u.password),a.signup=function(e,t){a.attempted=!0,a.signup_message="",a.no_health_exp=!(e.human_health||e.animal_health||e.env_health||e.health_exp_none),a.no_category=!(e.health_org_university||e.health_org_doh||e.health_org_clinic||e.health_org_other||e.health_org_none),a.no_notification=!(e.epicoreworkshop||e.conference||e.promoemail||e.othercontact);var o=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e.email);if(!(t&&o&&!a.no_health_exp&&!a.no_category&&!a.no_notification&&e.training&&e.other_training&&e.health_exp&&e.sector&&a.uservals.country&&a.uservals.state&&a.uservals.city))return a.signup_message="Form not complete. Please correct the errors above in red, and then submit again.",!1;"edit"==a.action?s({url:c+"scripts/updateuser.php",method:"POST",data:e}).then((function(e){var t=e.data;"success"===t.status?"fetp"==a.idtype?(r.path("/application/"+a.uid+"/edit/fetp"),a.signup_message="Successfully Updated profile"):r.path("/approval"):a.signup_message=t.message})):s({url:c+"scripts/signup.php",method:"POST",data:e}).then((function(e){var t=e.data;"success"===t.status?1==t.exists?a.signup_message="Your email address is already in the applicant system.":r.path("/application_confirm"):a.signup_message="Your email address is already in the applicant system."}))},a.mobile_message="",a.signIn=function(){a.formData.password="",a.autologin=!0,a.mobile&&void 0!==u.mobile_platform&&"iOS"==u.mobile_platform?f.checkSupport().then((function(){f.authenticate("Use touch id to login or cancel to login with password.").then((function(){void 0!==u.username&&void 0!==u.password&&u.username&&u.password?(a.formData.username=u.username,a.formData.password=u.password,a.userLogin(a.formData)):(a.autologin=!1,a.formData.password="",a.mobile_message="Please enter Epicore email (username) and password to use touch id")}),(function(){a.autologin=!1,a.formData.password="",a.mobile_message="Please enter email (username) and password to login."}))}),(function(e){a.autologin=!1,a.formData.password=""})):(a.autologin=!1,a.formData.password="")},a.userLogin=function(i){a.isRouteLoading=!0,void 0===i?(i={},void 0!==h.t?i.ticket_id=h.t:t.tid&&(i.ticket_id=t.tid),i.alert_id=t.aid?t.aid:null,i.event_id=t.eid?t.eid:null,i.usertype=0==r.path().indexOf("/fetp")?"fetp":"",i.app="web",i.epicore_version=m):(a.mobile&&(i.reg_id=u.registrationId,i.model=u.mobile_model,i.platform=u.mobile_platform,i.os_version=u.mobile_os_version,i.app="mobile",i.event_id=u.event_id,u.event_id=null),i.epicore_version=m),i.ticket_id||i.alert_id||i.event_id||a.loginForm.$valid?s({url:c+"scripts/login.php",method:"POST",data:i}).then((function(t){var s=t.data;if("success"===s.status){e.isOrganization=s.uinfo.organization_id>0;var l=4==s.uinfo.organization_id,c=void 0!==s.uinfo.active?s.uinfo.active:"Y",d=void 0!==s.uinfo.active&&s.uinfo.locations,p={uid:s.uinfo.user_id,isPromed:l,isOrganization:e.isOrganization,organization_id:s.uinfo.organization_id,organization:s.uinfo.orgname,fetp_id:s.uinfo.fetp_id?s.uinfo.fetp_id:null,email:s.uinfo.email,uname:s.uinfo.username,active:c,status:s.uinfo.status,superuser:s.uinfo.superuser,locations:d};if(u.username=i.username,n.put("epiUserInfo",p),u.user=p,e.error_message=!1,s.uinfo.fetp_id&&"N"==s.uinfo.active)var m="/training";else m=void 0!==h.redir?h.redir:"/"+s.path;a.isRouteLoading=!1,a.autologin=!1,r.path(m)}else a.isRouteLoading=!1,e.error_message=!0,a.autologin=!1,o.reload()}),(function(){a.isRouteLoading=!1,a.autologin=!1})):a.isRouteLoading=!1},a.userLogout=function(){n.remove("epiUserInfo"),l.sessionStorage.clear()},a.setPassword=function(t){if(a.isRouteLoading=!0,void 0!==h.t&&(t.ticket_id=h.t),!a.setpwForm.$valid)return a.isRouteLoading=!1,e.error_message="Invalid email or password",!1;s({url:c+"scripts/setpassword.php",method:"POST",data:t}).then((function(t){var i=t.data;if("success"===i.status){var s=void 0!==i.uinfo.active?i.uinfo.active:"Y";n.put("epiUserInfo",{uid:i.uinfo.user_id,isPromed:!1,isOrganization:!1,organization_id:i.uinfo.organization_id,organization:i.uinfo.orgname,fetp_id:i.uinfo.fetp_id,email:i.uinfo.email,uname:i.uinfo.username,active:s,status:i.uinfo.status}),e.error_message=!1;var l="/training";i.uinfo.fetp_id&&"Y"==i.uinfo.active&&(l=void 0!==h.redir?h.redir:"/"+i.path),a.isRouteLoading=!1,r.path(l)}else a.isRouteLoading=!1,e.error_message="Invalid email address",o.reload()}),(function(){a.isRouteLoading=!1}))},a.resetPassword=function(t){if(!a.setpwForm.$valid)return a.isRouteLoading=!1,e.error_message_pw="Invalid email address",!1;s({url:c+"scripts/resetpassword.php",method:"POST",data:t}).then((function(t){"success"===t.data.status?(a.isRouteLoading=!1,e.error_message_pw="Please check your email for instructions to reset your password.",o.reload()):(a.isRouteLoading=!1,e.error_message_pw="Invalid email address",o.reload())}),(function(){e.error_message_pw="Invalid email address",a.isRouteLoading=!1}))},a.mobile&&null!==u.event_id&&void 0!==u.event_id&&parseInt(u.event_id)>0&&(a.autologin=!0,a.formData.username=u.username,a.formData.password=u.password,a.userLogin(a.formData))};J.$inject=["$rootScope","$routeParams","$scope","$route","$cookies","$cookieStore","$location","$http","$window","urlBase","epicoreMode","$localStorage","epicoreCountries","epicoreVersion","$cordovaTouchID"];const Z=J,Q=angular.module("EpicoreApp.controllers",[]).controller("approvalController",u).controller("certController",m).controller("editRequestController",h).controller("eventsController",_).controller("eventsController2",b).controller("fetpController",y).controller("headerController",w).controller("mapController",P).controller("memberLocationsController",M).controller("metricsController",T).controller("modaccessController",R).controller("newsController",E).controller("publicRFIChildController",k).controller("publicRFIController",x).controller("requestController",q).controller("requestController2",N).controller("responseController",V).controller("successController",H).controller("testController",K).controller("userController",Z).filter("to_trusted",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]);var W=angular.module("EpicoreApp",[c.name,Q.name,"ngCookies","ngRoute","ngSanitize","uiGmapgoogle-maps","angular-google-analytics","ngCordova","ngStorage","google.places","ngFileUpload"]);W.value("epicoreVersion",epicore_config.vers).value("epicoreStartDate",epicore_config.EPICORE_START_DATE).value("epicoreV1StartDate",epicore_config.V1START_DATE),function(e){(function(e){e.directive("chosen",["$timeout",function(e){return{restrict:"A",link:function(t,a,o){e((function(){a.chosen()}),0,!1)}}}])})(e),function(e){e.directive("magnificPopup",(function(){return{restrict:"A",scope:{},link:function(e,t,a){var o=$(window).width()<=1024,i=a.magnificPopup;isThirdPartyUrl=/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(i),isTephinet="https://www.tephinet.org",targetType=function(e){return e||o?"_system":"_self"},o&&/iPad|iPhone|iPod/.test(navigator.userAgent)?t.magnificPopup({fixedContentPos:!0,callbacks:{beforeOpen:function(){i==isTephinet?$.magnificPopup.open({fixedContentPos:!0,items:{src:'<div id="popup-preloader">You are leaving EpiCore to visit a third-party. <a href="https://www.tephinet.org">Click to proceed</a></div>',type:"inline"}}):($.magnificPopup.open({fixedContentPos:!0,items:{src:'<div id="popup-preloader">Accessing an external resource, if it does not load, please close this window and try again</div>',type:"inline"}}),setTimeout((function(){$.magnificPopup.close(),$.magnificPopup.open({items:{src:i},type:"iframe",fixedContentPos:!0,removalDelay:300,mainClass:"mfp-fade"},0)}),4e3))}},removalDelay:300,mainClass:"mfp-fade"}):t[0].addEventListener("click",(function(e){return e.preventDefault(),window.open(i,targetType(a.target)),!1}))}}}))}(e),function(e){e.directive("modal",(function(){return{template:'<div class="modal fade"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title">{{ modalTitle }}</h4></div><div class="modal-body" ng-transclude>{{modalBody}}</div></div></div></div>',restrict:"E",transclude:!0,replace:!0,scope:!0,link:function(e,t,a){e.$watch(a.visible,(function(e){1==e?$(t).modal("show"):$(t).modal("hide")})),$(t).on("shown.bs.modal",(function(){e.$apply((function(){e.$parent[a.visible]=!0}))})),$(t).on("hidden.bs.modal",(function(){e.$apply((function(){e.$parent[a.visible]=!1}))}))}}}))}(e),function(e){e.directive("myYoutube",["$sce",function(e){return{restrict:"EA",scope:{code:"="},replace:!0,template:'<div style="height:550px; width: 980px;"><iframe style="overflow:hidden;height:100%;width:100%" width="100%" height="100%" src="{{url}}" frameborder="0" allowfullscreen></iframe></div>',link:function(t){t.$watch("code",(function(a){a&&(t.url=e.trustAsResourceUrl("https://www.youtube.com/embed/"+a+"?vq=hd720"))}))}}}])}(e),function(e){e.directive("siteHeader",(function(){return{restrict:"E",template:'<button class="btn btn-default"><i class="fa fa-arrow-circle-left"></i> {{back}} to Your EpiCore Dashboard</button>',scope:{back:"@back",icons:"@icons"},link:function(e,t){$(t[0]).on("click",(function(){history.back(),e.$apply()}))}}}))}(e)}(W);var X=epicore_config.app_mode,ee="templates/home/home.html?cb=";"mobile_prod"==X?(W.value("urlBase","https://epicore.org/"),W.value("epicoreMode","mobile"),ee="templates/login/login_mobile.html?cb="):"mobile_dev"==X?(W.value("urlBase","https://epicore.org/dev/"),W.value("epicoreMode","mobile"),ee="templates/login/login_mobile.html?cb="):"mobile_jandre"==X?(W.value("urlBase","https://epicore.org/~jandre/epicore/"),W.value("epicoreMode","mobile"),ee="templates/login/login_mobile.html?cb="):(W.value("urlBase",""),W.value("epicoreMode","web"));var te=Date.now();W.config(["$routeProvider",function(e){e.when("/events",{templateUrl:"templates/events/events.html?cb="+te,controller:"eventsController"}).when("/events2",{templateUrl:"templates/events/events2.html?cb="+te,controller:"eventsController2"}).when("/events_public",{templateUrl:"templates/events/events_public.html?cb="+te,controller:"eventsController2"}).when("/events_public/articles/:articleID",{templateUrl:"templates/events/publicEventsRFI.html?cb="+te,controller:"eventsController2"}).when("/events/closed",{templateUrl:"templates/events/events.html?cb="+te,controller:"eventsController"}).when("/events2/closed",{templateUrl:"templates/events/events2.html?cb="+te,controller:"eventsController2"}).when("/events/:id",{templateUrl:"templates/events/event.html?cb="+te,controller:"eventsController"}).when("/events2/:id",{templateUrl:"templates/events/event2.html?cb="+te,controller:"eventsController2"}).when("/reply/:id",{templateUrl:"templates/events/reply.html?cb="+te,controller:"eventsController"}).when("/reply2/:id",{templateUrl:"templates/events/reply2.html?cb="+te,controller:"eventsController2"}).when("/close/:id",{templateUrl:"templates/events/close.html?cb="+te,controller:"eventsController"}).when("/close2/:id",{templateUrl:"templates/events/close2.html?cb="+te,controller:"eventsController2"}).when("/reopen/:id",{templateUrl:"templates/events/reopen.html?cb="+te,controller:"eventsController"}).when("/reopen2/:id",{templateUrl:"templates/events/reopen2.html?cb="+te,controller:"eventsController2"}).when("/summary/:id",{templateUrl:"templates/events/summary.html?cb="+te,controller:"eventsController2"}).when("/followup/:id",{templateUrl:"templates/events/followup.html?cb="+te,controller:"eventsController"}).when("/followup2/:id",{templateUrl:"templates/events/followup2.html?cb="+te,controller:"eventsController2"}).when("/followup/:id/:response_id",{templateUrl:"templates/events/followup.html?cb="+te,controller:"eventsController"}).when("/followup2/:id/:response_id",{templateUrl:"templates/events/followup2.html?cb="+te,controller:"eventsController2"}).when("/rfi_dashboard",{templateUrl:"templates/events/events_metrics.html?cb="+te,controller:"eventsController2"}).when("/rfi_dashboard/closed",{templateUrl:"templates/events/events_metrics.html?cb="+te,controller:"eventsController2"}).when("/events_public/articles/:articleID",{templateUrl:"templates/events/publicrfi.html?cb="+te,controller:"publicRFIController"}).when("/map",{templateUrl:"templates/map/map.html?cb="+te,controller:"mapController"}).when("/rfi_step3",{templateUrl:"templates/request/rfi_step3.html?cb="+te,controller:"requestController2"}).when("/rfi_step2",{templateUrl:"templates/request/rfi_step2.html?cb="+te,controller:"requestController2"}).when("/rfi_step1",{templateUrl:"templates/request/rfi_step1.html?cb="+te,controller:"requestController2"}).when("/condition",{templateUrl:"templates/request/rfi_condition.html?cb="+te,controller:"requestController2"}).when("/duplicate",{templateUrl:"templates/request/rfi_duplicate2.html?cb="+te,controller:"requestController2"}).when("/population",{templateUrl:"templates/request/rfi_population.html?cb="+te,controller:"requestController2"}).when("/location",{templateUrl:"templates/request/rfi_location.html?cb="+te,controller:"requestController2"}).when("/location/:id",{templateUrl:"templates/request/rfi_location.html?cb="+te,controller:"requestController2"}).when("/rfi_step1/:id",{templateUrl:"templates/request/rfi_step1.html?cb="+te,controller:"requestController2"}).when("/time",{templateUrl:"templates/request/rfi_time.html?cb="+te,controller:"requestController2"}).when("/purpose",{templateUrl:"templates/request/rfi_purpose.html?cb="+te,controller:"requestController2"}).when("/source",{templateUrl:"templates/request/rfi_source.html?cb="+te,controller:"requestController2"}).when("/members",{templateUrl:"templates/request/rfi_members.html?cb="+te,controller:"requestController2"}).when("/sendrequest",{templateUrl:"templates/request/rfi_sendrequest.html?cb="+te,controller:"requestController2"}).when("/sent",{templateUrl:"templates/request/rfi_sent.html?cb="+te,controller:"requestController2"}).when("/request",{templateUrl:"templates/request/request.html?cb="+te,controller:"requestController"}).when("/request/:alertid",{templateUrl:"templates/request/request.html?cb="+te,controller:"requestController"}).when("/request2",{templateUrl:"templates/request/request2.html?cb="+te,controller:"requestController"}).when("/request3",{templateUrl:"templates/request/request3.html?cb="+te,controller:"requestController"}).when("/request_edit/:id",{templateUrl:"templates/request_edit/request_edit.html?cb="+te,controller:"editRequestController"}).when("/success/:id",{templateUrl:"templates/success/success.html?cb="+te,controller:"successController"}).when("/success/:id/:eid",{templateUrl:"templates/success/success.html?cb="+te,controller:"successController"}).when("/about",{templateUrl:"templates/about/about.html?cb="+te}).when("/how",{templateUrl:"templates/how/howitworks.html?cb="+te}).when("/who",{templateUrl:"templates/who/whocanapply.html?cb="+te}).when("/news",{templateUrl:"templates/news/newsletter.html?cb="+te,controller:"newsController"}).when("/educator",{templateUrl:"templates/educator/lpeducator.html?cb="+te}).when("/provider",{templateUrl:"templates/provider/lpprovider.html?cb="+te}).when("/researcher",{templateUrl:"templates/researcher/lpresearcher.html?cb="+te}).when("/professional",{templateUrl:"templates/professional/lpprofessional.html?cb="+te}).when("/terms",{templateUrl:"templates/terms/terms.html?cb="+te}).when("/fetp",{templateUrl:"templates/fetp/fetp.html?cb="+te}).when("/fetp/:eid",{templateUrl:"templates/fetp/fetp.html?cb="+te}).when("/mod/:tid/:aid",{templateUrl:"templates/mod/mod.html?cb="+te}).when("/application",{templateUrl:"templates/application/application_new.html?cb="+te}).when("/application_confirm",{templateUrl:"templates/application/application_confirm.html?cb="+te}).when("/application/:id/:action/:idtype",{templateUrl:"templates/application/application_new.html?cb="+te,controller:"userController"}).when("/trainingvideos",{templateUrl:"templates/trainingvideos/trainingvideos.html?cb="+te,controller:"userController"}).when("/resources",{templateUrl:"templates/resources/resources.html?cb="+te,controller:"userController"}).when("/approval",{templateUrl:"templates/approval/approval.html?cb="+te,controller:"approvalController"}).when("/approval/accepted",{templateUrl:"templates/approval/approval.html?cb="+te}).when("/approval/pre_approved",{templateUrl:"templates/approval/approval.html?cb="+te}).when("/approval/members",{templateUrl:"templates/approval/approval.html?cb="+te}).when("/approval/denied",{templateUrl:"templates/approval/approval.html?cb="+te}).when("/login",{templateUrl:"templates/login/login.html?cb="+te}).when("/login_mobile",{templateUrl:"templates/login/login_mobile.html?cb="+te}).when("/setpassword",{templateUrl:"templates/setpassword/setpassword.html?cb="+te}).when("/resetpassword",{templateUrl:"templates/resetpassword/resetpassword.html?cb="+te}).when("/home",{templateUrl:ee+te}).when("/training",{templateUrl:"templates/training/test.html?cb="+te,controller:"testController"}).when("/certificate",{templateUrl:"templates/certificate/certificate.html?cb="+te,controller:"certController"}).when("/modaccess",{templateUrl:"templates/modaccess/modaccess.html?cb="+te,controller:"modaccessController"}).when("/requesters_dashboard",{templateUrl:"templates/modaccess/requesters_dashboard.html?cb="+te,controller:"modaccessController"}).when("/member_locations",{templateUrl:"templates/member_locations/member_locations.html?cb="+te,controller:"memberLocationsController"}).when("/metrics",{templateUrl:"templates/responders_metrics.html?cb="+te,controller:"metricsController"}).otherwise({redirectTo:"/home"})}]),W.run(["$rootScope","$location","$window",function(e,t,a){e.$on("$routeChangeSuccess",(function(e,o,i,n){a.ga("send","pageview",{page:t.path()})}))}]),"mobile_dev"!=X&&"mobile_prod"!=X&&"mobile_jandre"!=X||W.run(["$http","$cordovaPushV5","$rootScope","$cordovaDevice","$localStorage",function(e,t,a,o,i){document.addEventListener("deviceready",(function(){var e={android:{senderID:epicore_config.android_senderId},ios:{alert:"true",badge:"true",sound:"true",clearBadge:"true"},browser:{pushServiceURL:"http://push.api.phonegap.com/v1/push"},windows:{}};t.initialize(e).then((function(){t.onNotification(),t.onError(),t.register().then((function(e){i.registrationId=e}))})),a.$on("$cordovaPushV5:notificationReceived",(function(e,t){i.pushMessage=t.message;var a=t.message.split(":")[0].split("#");i.event_id=a[1]})),a.$on("$cordovaPushV5:errorOcurred",(function(e,t){i.pushError=t.message})),i.mobile_model=o.getModel(),i.mobile_platform=o.getPlatform(),i.mobile_os_version=o.getVersion()}),!1)}]),W.config(["AnalyticsProvider",function(e){e.setAccount("UA-72336136-1"),e.useAnalytics(!1)}]),W.value("epicoreCountries",[{name:"Afghanistan",code:"AF"},{name:"Åland Islands",code:"AX"},{name:"Albania",code:"AL"},{name:"Algeria",code:"DZ"},{name:"American Samoa",code:"AS"},{name:"Andorra",code:"AD"},{name:"Angola",code:"AO"},{name:"Anguilla",code:"AI"},{name:"Antarctica",code:"AQ"},{name:"Antigua and Barbuda",code:"AG"},{name:"Argentina",code:"AR"},{name:"Armenia",code:"AM"},{name:"Aruba",code:"AW"},{name:"Australia",code:"AU"},{name:"Austria",code:"AT"},{name:"Azerbaijan",code:"AZ"},{name:"Bahamas",code:"BS"},{name:"Bahrain",code:"BH"},{name:"Bangladesh",code:"BD"},{name:"Barbados",code:"BB"},{name:"Belarus",code:"BY"},{name:"Belgium",code:"BE"},{name:"Belize",code:"BZ"},{name:"Benin",code:"BJ"},{name:"Bermuda",code:"BM"},{name:"Bhutan",code:"BT"},{name:"Bolivia",code:"BO"},{name:"Bosnia and Herzegovina",code:"BA"},{name:"Botswana",code:"BW"},{name:"Bouvet Island",code:"BV"},{name:"Brazil",code:"BR"},{name:"British Indian Ocean Territory",code:"IO"},{name:"Brunei Darussalam",code:"BN"},{name:"Bulgaria",code:"BG"},{name:"Burkina Faso",code:"BF"},{name:"Burundi",code:"BI"},{name:"Cambodia",code:"KH"},{name:"Cameroon",code:"CM"},{name:"Canada",code:"CA"},{name:"Cape Verde",code:"CV"},{name:"Cayman Islands",code:"KY"},{name:"Central African Republic",code:"CF"},{name:"Chad",code:"TD"},{name:"Chile",code:"CL"},{name:"China",code:"CN"},{name:"Christmas Island",code:"CX"},{name:"Cocos (Keeling) Islands",code:"CC"},{name:"Colombia",code:"CO"},{name:"Comoros",code:"KM"},{name:"Congo, Republic of the",code:"CG"},{name:"Congo, The Democratic Republic of the",code:"CD"},{name:"Cook Islands",code:"CK"},{name:"Costa Rica",code:"CR"},{name:"Cote D'Ivoire",code:"CI"},{name:"Croatia",code:"HR"},{name:"Cuba",code:"CU"},{name:"Cyprus",code:"CY"},{name:"Czech Republic",code:"CZ"},{name:"Denmark",code:"DK"},{name:"Djibouti",code:"DJ"},{name:"Dominica",code:"DM"},{name:"Dominican Republic",code:"DO"},{name:"Ecuador",code:"EC"},{name:"Egypt",code:"EG"},{name:"El Salvador",code:"SV"},{name:"Equatorial Guinea",code:"GQ"},{name:"Eritrea",code:"ER"},{name:"Estonia",code:"EE"},{name:"Ethiopia",code:"ET"},{name:"Falkland Islands (Malvinas)",code:"FK"},{name:"Faroe Islands",code:"FO"},{name:"Fiji",code:"FJ"},{name:"Finland",code:"FI"},{name:"France",code:"FR"},{name:"French Guiana",code:"GF"},{name:"French Polynesia",code:"PF"},{name:"French Southern Territories",code:"TF"},{name:"Gabon",code:"GA"},{name:"Gambia",code:"GM"},{name:"Georgia",code:"GE"},{name:"Germany",code:"DE"},{name:"Ghana",code:"GH"},{name:"Gibraltar",code:"GI"},{name:"Greece",code:"GR"},{name:"Greenland",code:"GL"},{name:"Grenada",code:"GD"},{name:"Guadeloupe",code:"GP"},{name:"Guam",code:"GU"},{name:"Guatemala",code:"GT"},{name:"Guernsey",code:"GG"},{name:"Guinea",code:"GN"},{name:"Guinea-Bissau",code:"GW"},{name:"Guyana",code:"GY"},{name:"Haiti",code:"HT"},{name:"Heard Island and Mcdonald Islands",code:"HM"},{name:"Holy See (Vatican City State)",code:"VA"},{name:"Honduras",code:"HN"},{name:"Hong Kong",code:"HK"},{name:"Hungary",code:"HU"},{name:"Iceland",code:"IS"},{name:"India",code:"IN"},{name:"Indonesia",code:"ID"},{name:"Iran, Islamic Republic Of",code:"IR"},{name:"Iraq",code:"IQ"},{name:"Ireland",code:"IE"},{name:"Isle of Man",code:"IM"},{name:"Israel",code:"IL"},{name:"Italy",code:"IT"},{name:"Jamaica",code:"JM"},{name:"Japan",code:"JP"},{name:"Jersey",code:"JE"},{name:"Jordan",code:"JO"},{name:"Kazakhstan",code:"KZ"},{name:"Kenya",code:"KE"},{name:"Kiribati",code:"KI"},{name:"Korea, Democratic People's Republic of",code:"KP"},{name:"Korea, Republic of",code:"KR"},{name:"Kosovo",code:"XK"},{name:"Kuwait",code:"KW"},{name:"Kyrgyzstan",code:"KG"},{name:"Lao People's Democratic Republic",code:"LA"},{name:"Latvia",code:"LV"},{name:"Lebanon",code:"LB"},{name:"Lesotho",code:"LS"},{name:"Liberia",code:"LR"},{name:"Libyan Arab Jamahiriya",code:"LY"},{name:"Liechtenstein",code:"LI"},{name:"Lithuania",code:"LT"},{name:"Luxembourg",code:"LU"},{name:"Macao",code:"MO"},{name:"Macedonia, The Former Yugoslav Republic of",code:"MK"},{name:"Madagascar",code:"MG"},{name:"Malawi",code:"MW"},{name:"Malaysia",code:"MY"},{name:"Maldives",code:"MV"},{name:"Mali",code:"ML"},{name:"Malta",code:"MT"},{name:"Marshall Islands",code:"MH"},{name:"Martinique",code:"MQ"},{name:"Mauritania",code:"MR"},{name:"Mauritius",code:"MU"},{name:"Mayotte",code:"YT"},{name:"Mexico",code:"MX"},{name:"Micronesia, Federated States of",code:"FM"},{name:"Moldova, Republic of",code:"MD"},{name:"Monaco",code:"MC"},{name:"Mongolia",code:"MN"},{name:"Montenegro",code:"ME"},{name:"Montserrat",code:"MS"},{name:"Morocco",code:"MA"},{name:"Mozambique",code:"MZ"},{name:"Myanmar",code:"MM"},{name:"Namibia",code:"NA"},{name:"Nauru",code:"NR"},{name:"Nepal",code:"NP"},{name:"Netherlands",code:"NL"},{name:"Netherlands Antilles",code:"AN"},{name:"New Caledonia",code:"NC"},{name:"New Zealand",code:"NZ"},{name:"Nicaragua",code:"NI"},{name:"Niger",code:"NE"},{name:"Nigeria",code:"NG"},{name:"Niue",code:"NU"},{name:"Norfolk Island",code:"NF"},{name:"Northern Mariana Islands",code:"MP"},{name:"Norway",code:"NO"},{name:"Oman",code:"OM"},{name:"Pakistan",code:"PK"},{name:"Palau",code:"PW"},{name:"Palestinian Territory",code:"PS"},{name:"Panama",code:"PA"},{name:"Papua New Guinea",code:"PG"},{name:"Paraguay",code:"PY"},{name:"Peru",code:"PE"},{name:"Philippines",code:"PH"},{name:"Pitcairn",code:"PN"},{name:"Poland",code:"PL"},{name:"Portugal",code:"PT"},{name:"Puerto Rico",code:"PR"},{name:"Qatar",code:"QA"},{name:"Reunion",code:"RE"},{name:"Romania",code:"RO"},{name:"Russian Federation",code:"RU"},{name:"Rwanda",code:"RW"},{name:"Saint Helena",code:"SH"},{name:"Saint Kitts and Nevis",code:"KN"},{name:"Saint Lucia",code:"LC"},{name:"Saint Pierre and Miquelon",code:"PM"},{name:"Saint Vincent and the Grenadines",code:"VC"},{name:"Samoa",code:"WS"},{name:"San Marino",code:"SM"},{name:"Sao Tome and Principe",code:"ST"},{name:"Saudi Arabia",code:"SA"},{name:"Senegal",code:"SN"},{name:"Serbia",code:"RS"},{name:"Seychelles",code:"SC"},{name:"Sierra Leone",code:"SL"},{name:"Singapore",code:"SG"},{name:"Slovakia",code:"SK"},{name:"Slovenia",code:"SI"},{name:"Solomon Islands",code:"SB"},{name:"Somalia",code:"SO"},{name:"South Africa",code:"ZA"},{name:"South Georgia and the South Sandwich Islands",code:"GS"},{name:"South Sudan",code:"SS"},{name:"Spain",code:"ES"},{name:"Sri Lanka",code:"LK"},{name:"Sudan",code:"SD"},{name:"Suriname",code:"SR"},{name:"Svalbard and Jan Mayen",code:"SJ"},{name:"Swaziland",code:"SZ"},{name:"Sweden",code:"SE"},{name:"Switzerland",code:"CH"},{name:"Syrian Arab Republic",code:"SY"},{name:"Taiwan",code:"TW"},{name:"Tajikistan",code:"TJ"},{name:"Tanzania, United Republic of",code:"TZ"},{name:"Thailand",code:"TH"},{name:"East Timor",code:"TL"},{name:"Togo",code:"TG"},{name:"Tokelau",code:"TK"},{name:"Tonga",code:"TO"},{name:"Trinidad and Tobago",code:"TT"},{name:"Tunisia",code:"TN"},{name:"Turkey",code:"TR"},{name:"Turkmenistan",code:"TM"},{name:"Turks and Caicos Islands",code:"TC"},{name:"Tuvalu",code:"TV"},{name:"Uganda",code:"UG"},{name:"Ukraine",code:"UA"},{name:"United Arab Emirates",code:"AE"},{name:"United Kingdom",code:"GB"},{name:"United States",code:"US"},{name:"United States Minor Outlying Islands",code:"UM"},{name:"Uruguay",code:"UY"},{name:"Uzbekistan",code:"UZ"},{name:"Vanuatu",code:"VU"},{name:"Venezuela",code:"VE"},{name:"Vietnam",code:"VN"},{name:"Virgin Islands, British",code:"VG"},{name:"Virgin Islands, U.S.",code:"VI"},{name:"Wallis and Futuna",code:"WF"},{name:"Western Sahara",code:"EH"},{name:"Yemen",code:"YE"},{name:"Zambia",code:"ZM"},{name:"Zimbabwe",code:"ZW"}])})();